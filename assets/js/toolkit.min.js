(()=>{var Ce=Object.defineProperty;var xe=(f,e,t)=>e in f?Ce(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var g=(f,e,t)=>(xe(f,typeof e!="symbol"?e+"":e,t),t);var B=new Map;function Se(f,e={},t=!0){if(typeof f!="string"||!f.trim().length)return Promise.reject("Reflow: Endpoint Required");if(f=f.replace(/\/+/,""),B.has(f))return B.get(f);let i=fetch(Reflow.APIURL+"/stores/"+Reflow.storeID+"/"+f,e).then(async s=>{let r=await s.json();if(!s.ok){let n=Error(r.error||"HTTP error");throw n.status=s.status,n.data=r,n}return r});return t&&e.method!="POST"&&B.set(f,i),i}var x=Se;var H=class{constructor(e,t={}){g(this,"mockData",null);this.node=e,this.demoMode=t.demoMode||!1,t.mockData&&(this.mockData=t.mockData)}static scan(){let e=document.querySelectorAll(`[data-reflow-type=${this.type}]`);return Array.from(e).map(t=>new this(t))}init(){}getAPIEndpoint(){return""}async fetchData(){if(this.mockData)return this.mockData;let e=this.getAPIEndpoint(),t=await x(e);return t.error?(console.error("Reflow:",t.error),null):t}parseConfigString(e){let t={};for(let i of e.split(","))t[i.trim().toLowerCase()]=!0;return t}parseShowString(){return this.node.dataset.reflowShow?this.parseConfigString(this.node.dataset.reflowShow):{full:!0}}isDemoMode(){return this.demoMode}async update(){}};g(H,"type","");var q=H;function ke(f){let e=document.createElement("div");return e.innerHTML=f.trim(),e.firstElementChild}var se=ke;function Le(f,e=null){return e=e||document,f.trim()[0]=="<"?se(f):e.querySelectorAll(f)}var a=Le;var j=class extends q{constructor(e,t={}){super(e,t);t=Object.assign({type:"success",action:this.hide.bind(this),buttonAction:null,title:"",description:"",button:null,timeout:5e3},t),this.set(t),this.node.innerHTML=`
			<div class="ref-notification-content">
				<div class="ref-notification-title"></div>
				<div class="ref-notification-description"></div>
				<div class="ref-close-button">\xD7</div>
			</div>
		`,this.descriptionElement=this.node.querySelector(".ref-notification-description"),t.button&&(this.button=a('<a class="ref-button"></a>'),this.button.textContent=t.button,this.node.querySelector(".ref-notification-content").append(this.button)),this.hideTimeout=null}init(){this.node.addEventListener("click",this.onClick.bind(this))}set(e={}){Object.assign(this,e),e.timeout===0&&clearTimeout(this.hideTimeout)}onClick(e){if(e.target.closest(".ref-close-button")){this.hide();return}if(e.target.closest(".ref-button")&&this.buttonAction){this.buttonAction();return}this.action&&this.action(this)}hide(){this.node.remove()}show(){j.scan().forEach(t=>t.node.remove()),document.body.append(this.node),this.update(),this.timeout&&this.hideAfter(this.timeout)}hideAfter(e){clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{this.hide()},e)}update(){let e=this.node.querySelector(".ref-notification-title");e&&(e.textContent=this.title);let t=this.node.querySelector(".ref-notification-description");return t&&(t.textContent=this.description),this.node.classList.add("ref-notification",this.type),this.button&&this.button.classList.add("ref-button-"+this.type),this.description||this.node.classList.add("no-description"),setTimeout(()=>{this.node.style.transform="translateY(-20px)"},0),this.node}},N=j;g(N,"type","toast");var E=N;var ae=class extends q{constructor(e,t={}){super(e,t);e.innerHTML=`
			<div class="ref-quantity-widget">
				<div class="ref-decrease"><span></span></div>
				<input type="text" value="1" />
				<div class="ref-increase"><span></span></div>
			</div>
		`,this.input=e.querySelector("input"),this.inStock=t.inStock,this._onQuantityChange=t.onChange}init(){this.node.addEventListener("change",this.onChange.bind(this)),this.node.addEventListener("click",this.onClick.bind(this))}onChange(e){if(e.target===this.input){if(!this.inStock)return;let t=Math.max(1,parseInt(e.target.value,10)||1);if(t=Math.min(t,999),e.target.value=t,t==this.getQuantity(t))return;this.setQuantity(t),this._onQuantityChange&&this._onQuantityChange(this);return}}async onClick(e){let t=!!e.target.closest(".ref-increase"),i=!!e.target.closest(".ref-decrease");if(t||i){if(!this.inStock)return;let s=this.input,r=parseInt(s.value,10),n=this.getMaxQuantity();if(t){if(r>=n)return;r++}else if(i){if(r<=1)return;r--}s.value=r,this.setQuantity(r),this._onQuantityChange&&this._onQuantityChange(this)}}getProduct(){return this.node.dataset.reflowProduct}setProduct(e){this.node.dataset.reflowProduct=e}getQuantity(){return this.node.dataset.reflowQuantity||1}setQuantity(e=1){this.node.dataset.reflowQuantity=e,a(".ref-increase",this.node)[0].classList.remove("inactive"),e>=this.getMaxQuantity()&&a(".ref-increase",this.node)[0].classList.add("inactive")}getMaxQuantity(){return parseInt(this.node.dataset.reflowMaxQty,10)||999}setMaxQuantity(e=999){this.node.dataset.reflowMaxQty=e}getVariant(){return this.node.dataset.reflowVariant}setVariant(e){this.node.dataset.reflowVariant=e}async update(e){return this.input.value=this.getQuantity(),this.inStock||this.node.querySelector(".ref-quantity-widget").classList.add("inactive"),this.node}},I=ae;function Pe(f,e=100,t=!1){var i=0,s=null;return(...r)=>{t&&!i&&f(...r),i++,clearTimeout(s),s=setTimeout(()=>{(!t||i>1)&&f(...r),i=0},e)}}var z=Pe;function qe(f,e){let t=0;return e.hasDecimal&&(f=f/100,t=2),new Intl.NumberFormat("en-US",{style:"currency",currency:e.code,maximumFractionDigits:t}).format(f)}var A=qe;var Q=(f,e,t)=>{document.dispatchEvent(new Event(f),e),"BroadcastChannel"in window&&new BroadcastChannel("reflow").postMessage({event:f,data:t})},M=(f,e)=>{if(document.addEventListener(f,e),"BroadcastChannel"in window){let t=new BroadcastChannel("reflow");t.onmessage=i=>{i.data.event&&i.data.event==f&&e()}}};var T=class extends q{constructor(e,t){super(e,t);g(this,"_state",null);g(this,"step","cart");g(this,"shippingMethodIndex",-1);g(this,"shippingAddress",{});g(this,"billingAddress",{});g(this,"billingVisible",!1);g(this,"paypalButtonsInitialized",!1);g(this,"backendUpdateTimeout",null);g(this,"pendingBackendUpdates",{});e.innerHTML=`
			<div class="reflow-shopping-cart">

				<div class="ref-loading-overlay"></div>
				<div class="ref-message"></div>

				<div class="ref-cart">
					<div class="ref-heading">Корзина</div>
					<div class="ref-th">
						<div class="ref-product-col">Товар</div>
						<div class="ref-price-col">Цена</div>
						<div class="ref-quantity-col">Количество</div>
						<div class="ref-total-col">Итого</div>
					</div>
					<div class="ref-cart-table"></div>
					<div class="ref-footer">
						<div class="ref-links"></div>
						<div class="ref-totals">
							<div class="ref-subtotal"></div>
							<div class="ref-shipping-taxes">Доставка и налоги рассчитываются во время<br> оформления заказа.</div>
							<div class="ref-button ref-checkout-button">Оплатить</div>
						</div>
					</div>
				</div>

				<div class="ref-checkout">
					<div class="ref-checkout-content">
						<form class="ref-details">
							<div class="ref-back">\u2190 Назад к корзине</div>
							<div class="ref-heading">Информация о покупателе</div>
							<label>
								<span>Email</span>
								<input type="email" name="email" id="ref-field-email" class="ref-form-control" value="" placeholder="Введите e-mail" required data-state-src="email" />
								<div class="ref-validation-error"></div>
							</label>
							<label>
								<span>Телефон</span>
								<input type="tel" name="phone" id="ref-field-phone" class="ref-form-control" value="" pattern="[0-9\\+\\- ]{5,30}" placeholder="+77777777777" required  data-state-src="phone" />
								<div class="ref-validation-error"></div>
							</label>
							<div class="ref-shipping-address-holder"></div>
							<div class="ref-tax-note">
								<label class="ref-checkbox">
									<input type="checkbox" id="ref-field-have-tax-exemption" class="ref-form-control" />
									<span></span>
								</label>
								<div class="ref-tax-exemption-fields">
									<label class="ref-tax-exemption-file">
										<span></span>
										<input type="file" name="tax-exemption-file" id="ref-field-exemption-file" class="ref-form-control" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" required />
										<div class="ref-validation-error"></div>
									</label>
									<label class="ref-tax-exemption-text">
										<span></span>
										<input type="text" name="tax-exemption-text" id="ref-field-exemption-text" class="ref-form-control" required data-state-src="tax-text" />
										<div class="ref-validation-error"></div>
									</label>
								</div>
							</div>
							<hr />
							<label class="ref-field-collapsible ref-note-to-seller">
								<span class="ref-field-toggle">Сообщение продавцу</span>
								<textarea id="ref-field-note-seller" class="ref-form-control" name="note-to-seller" row="4" maxlength="1000" placeholder="Если у вас есть особые указания, которые вы хотите дать продавцу, напишите их здесь." data-state-src="note"></textarea>
								<div class="ref-validation-error"></div>
							</label>
							<hr />
							<label class="ref-accept-terms"></label>
							<div class="ref-button ref-next">Дальше</div>
						</form>
						<div class="ref-shipping-payment">
							<div class="ref-back">\u2190 Назад к деталям</div>
							<div class="ref-heading">Доставка &amp; оплата</div>
							<div class="ref-express">
								<div class="ref-paypal-button-holder"></div>
								<span>Быстрыя оплата</span>
							</div>
							<div class="ref-standard">
								<form class="ref-shipping-form">
									<div class="ref-heading-small">Адрес доставки</div>
									<div class="ref-shipping-address-holder"></div>
									<label class="ref-checkbox ref-billing-checkbox">
										<input type="checkbox" id="ref-field-billing-same-shipping" />
										<span>Адрес выставления счета тот же, что и адрес доставки</span>
									</label>
									<fieldset class="ref-billing-address" disabled>
										<div class="ref-heading-small">Расчётный адрес</div>
										<div class="ref-billing-address-holder"></div>
									</fieldset>
									<div class="ref-heading-shipping-methods ref-heading-small">Метод доставки</div>
									<div class="ref-shipping-methods ref-error-parent"></div>
								</form>
								<div>
									<div class="ref-heading-small">Оплата</div>
									<div class="ref-standard-payment-buttons"></div>
								</div>
							</div>
						</div>
						<div class="ref-instructions">
							<div class="ref-heading ref-payment-method-name"></div>
							<div class="ref-payment-method-instructions"></div>
						</div>
						<div class="ref-links"></div>
					</div>
					<div class="ref-checkout-summary">
						<div class="ref-heading">Ваш заказ</div>
						<div class="ref-products"></div>
						<hr>
						<div class="ref-coupon-code">
							<div class="ref-coupon-container">
								<div class="ref-coupon-input-holder">
									<input id="ref-coupon-input" class="ref-form-control" name="coupon-code" type="text" maxlength="32" autocomplete="off" placeholder="Введите купон или промокод">
									<span class="ref-coupon-input-clear" title="Clear">\u2715</span>
								</div>
								<div class="ref-button ref-button-success ref-add-code inactive">Применить</div>
							</div>
							<div class="ref-validation-error"></div>
						</div>
						<hr>
						<div class="ref-totals">
							<div class="ref-subtotal">
								<div class="ref-row"><span>Всего</span><span></span></div>
							</div>
							<div class="ref-applied-coupon">
								<div class="ref-row">
									<div class="ref-row"><span></span><span class="ref-remove-coupon">удалить</span></div>
									<span></span>
								</div>
								<div class="ref-applied-coupon-error"></div>
							</div>
							<div class="ref-shipping">
								<div class="ref-row"><span>Доставка</span><span></span></div>
							</div>
							<div class="ref-taxes">
								<div class="ref-row"><span></span><span></span></div>
							</div>
						</div>
						<hr />
						<div class="ref-total">
							<div class="ref-row"><span>Итого</span><span></span></div>
							<div class="ref-total-note">Все цены указаны в <span></span></div>
						</div>
					</div>
					<div class="ref-summary-toggle ref-field-collapsible">
						<span class="ref-field-toggle">Показать заказ</span>
					</div>
				</div>
			</div>
		`,this.message=e.querySelector(".ref-message"),this.cart=e.querySelector(".ref-cart"),this.checkout=e.querySelector(".ref-checkout"),this.productTable=e.querySelector(".ref-cart-table"),this.loadingOverlay=e.querySelector(".ref-loading-overlay"),this.cartSubtotal=e.querySelector(".ref-cart .ref-subtotal"),this.noteToSeller=e.querySelector(".ref-note-to-seller"),this.acceptTerms=e.querySelector(".ref-accept-terms"),this.couponCode=e.querySelector(".ref-coupon-code"),this.couponInput=e.querySelector("#ref-coupon-input"),this.couponButton=e.querySelector(".ref-button.ref-add-code"),this.couponClear=e.querySelector(".ref-coupon-input-clear"),this.couponError=e.querySelector(".ref-coupon-code .ref-validation-error"),this.taxNote=e.querySelector(".ref-tax-note"),this.taxExemptionCheckbox=e.querySelector("#ref-field-have-tax-exemption"),this.detailsForm=e.querySelector("form.ref-details"),this.shippingForm=e.querySelector("form.ref-shipping-form"),this.fileExemptionInput=e.querySelector("#ref-field-exemption-file"),this.textExemptionInput=e.querySelector("#ref-field-exemption-text"),this.billingSameAsShipping=e.querySelector("#ref-field-billing-same-shipping"),this.shippingMethodHeading=e.querySelector(".ref-heading-shipping-methods"),this.shippingMethodHolder=e.querySelector(".ref-shipping-methods"),this.toShippingPageButton=e.querySelector(".ref-next"),this.standardPaymentButtonHolder=e.querySelector(".ref-standard-payment-buttons"),new URL(location.href).searchParams.has("checkout")&&(this.step="details"),this.detailsAddressWidget=new U({model:this.shippingAddress,fieldPrefix:"shipping",countryOnly:!0,getCountries:()=>this.getShippableCountries(),hidePostCodeIfNoRegion:!0,onChange:()=>this.updateAddress("details")}),this.shippingAddressWidget=new U({model:this.shippingAddress,fieldPrefix:"shipping",getCountries:()=>this.getShippableCountries(),onChange:()=>this.updateAddress("shipping")}),this.billingAddressWidget=new U({model:this.billingAddress,fieldPrefix:"billing",getCountries:()=>this.getShippableCountries()})}init(){this.taxExemptionCheckbox.addEventListener("change",this.onTaxExemptionChange.bind(this)),this.billingSameAsShipping.addEventListener("change",this.onShowbillingChange.bind(this)),this.shippingMethodHolder.addEventListener("change",this.onShippingMethodHolderChange.bind(this)),this.couponInput.addEventListener("input",this.onCouponCodeInput.bind(this)),this.node.addEventListener("click",this.onClick.bind(this)),this.node.addEventListener("keypress",this.onKeypress.bind(this)),this.scheduleRefresh=z(this.refresh.bind(this),250),M("reflow-add-to-cart",this.scheduleRefresh),M("reflow-update-cart-product",this.scheduleRefresh),M("reflow-remove-cart-product",this.scheduleRefresh)}isDemoMode(){return this.demoMode||this.state&&this.state.demoMode}getShippableCountries(){var e;return((e=this.state)==null?void 0:e.shippableCountries)||[]}getCountryByCode(e){return this.getShippableCountries().find(t=>t.country_code==e)}async getPaypalInstance(){return window.paypal?window.paypal:(T._paypalPromise||(T._paypalPromise=new Promise((e,t)=>{let i=document.createElement("script");i.onload=()=>e(window.paypal),i.onerror=s=>t(s),document.body.append(i),i.src="https://www.paypal.com/sdk/js?client-id="+this.state.paymentProviders.paypal.clientID+"&disable-funding=credit,bancontact,blik,eps,giropay,ideal,mercadopago,mybank,p24,sepa,sofort,venmo&merchant-id="+this.state.paymentProviders.paypal.merchantID+"&currency="+this.state.currency+"&integration-date=2021-09-01"})),T._paypalPromise)}restoreUserInput(){if(!this.state)return;let e=this.node.querySelectorAll("[data-state-src]"),t={shipping:"shippingAddress",billing:"billingAddress"};e:for(let i of e){let r=i.getAttribute("data-state-src").split(".");r[0]in t&&(r[0]=t[r[0]]);let n=this.state;for(let o=0;o<r.length;o++){if(!n||!(r[o]in n))continue e;n=n[r[o]]}i.value=n}this.state.shippingAddress&&Object.assign(this.shippingAddress,this.state.shippingAddress),this.state.billingAddress&&Object.assign(this.billingAddress,this.state.billingAddress),this.billingVisible=Object.keys(this.billingAddress).length>0,this.detailsAddressWidget.update(!0,!0),this.shippingAddressWidget.update(!0,!0),this.billingAddressWidget.update(!0,!0)}showSystemError(e="Error",t=""){let i=new E(a('<div data-reflow-type="toast"></div>'),{type:"error",title:e,description:t});i.init(),i.show()}get key(){return localStorage.reflowCartKey}async onClick(e){var t,i;if(!e.target.getAttribute("data-disabled-click")){if(e.target.matches(".ref-product-remove")){let s=e.target.closest(".ref-product"),r=s.dataset.id,n=s.dataset.variant_id,o=new FormData,l=s.dataset.personalization;l&&l.length&&o.append("personalization",l),Reflow.cart.scheduleAPICall(r+"-remove",()=>Reflow.cart.removeProduct(r,n,o),0)}if(e.target.matches(".ref-cart .ref-checkout-button")){for(let s of this.state.errors)if(s.severity=="fatal"&&["unavailable-quantity","product-min-qty-not-reached","product-max-qty-exceeded"].includes(s.type)){this.showSystemError("Error",this.getStateError(s));return}this.step="details",this.update()}if(e.target.matches(".ref-back")&&(this.step=="shipping"?this.step="details":this.step=="details"&&(this.step="cart"),this.update()),e.target.closest(".ref-field-collapsible .ref-field-toggle")&&e.target.closest(".ref-field-collapsible").classList.toggle("open"),e.target.closest(".ref-summary-toggle")&&a(".ref-checkout-summary",this.node)[0].classList.toggle("open"),e.target.matches(".ref-button.ref-next"))if(this.clearFormErrors(),this.detailsForm.checkValidity()){this.showLoading();try{if(await x(`/update-details/${this.key}/`,{method:"POST",body:new FormData(this.detailsForm)},!1),await this.refreshState(),this.state.coupon&&this.state.coupon.error){this.showSystemError(this.state.coupon.error),this.update();return}for(let s of this.state.errors)if(s.severity=="fatal"&&s.type=="min-val-not-reached"){this.showSystemError("Error",this.getStateError(s)),this.update();return}this.canShip()&&(this.step="shipping"),this.update()}catch(s){s.data&&s.data.errors&&(this.showFormErrors(this.detailsForm,s.data.errors),s.data.errors.system&&this.showSystemError("Couldn't update cart details",s.data.errors.system))}finally{this.hideLoading()}}else this.detailsForm.reportValidity();if(e.target.matches(".ref-product-update-cart")&&(this.step="cart",this.update()),e.target.closest(".button-demo-payment")){let s=new E(a('<div data-reflow-type="toast"></div>'),{type:"info",title:"Payments unavailable in demo",description:"To prevent accidental checkouts, payments are disabled in this demo."});s.init(),s.show();return}if(e.target.matches(".ref-proceed-stripe-payment, .ref-complete-order, .ref-zero-value-complete-order")){if(this.isDemoMode())return;if((t=this.state.vacationMode)==null?void 0:t.enabled){let s=this.state.vacationMode.message.length?this.state.vacationMode.message:"The store is temporarily unavailable.",r=new E(a('<div data-reflow-type="toast"></div>'),{type:"error",title:s});r.init(),r.show();return}if(this.clearFormErrors(),this.shippingForm.checkValidity()){this.showLoading();let s=new FormData(this.shippingForm);s.append("success-url",this.getSuccessURL({session_id:"{CHECKOUT_SESSION_ID}"})),s.append("cancel-url",this.getCancelURL());try{if(await this.refreshState(),this.update(),!this.canFinish()){this.showSystemError("Error",this.getStateErrors()[0]);return}if(e.target.matches(".ref-proceed-stripe-payment")){let r=await x(`/update-shipping/${this.key}/`,{method:"POST",body:s},!1);if(r.success&&r.stripeCheckoutURL){window.location=r.stripeCheckoutURL;return}}if(e.target.matches(".ref-complete-order")){let r=e.target.dataset.paymentMethod,n=Object.entries(this.state.paymentProviders).find(l=>l[1].id==r);if(!n)return;s.append("payment-method",r);let o=await x(`/complete-order/${this.key}/`,{method:"POST",body:s},!1);if(o.success&&o.orderCompleted&&o.order){if(n=n[1],n.instructions){let l=this.checkout.querySelector(".ref-instructions");l.querySelector(".ref-payment-method-name").textContent=n.name;let c=n.instructions.replaceAll("{orderid}",o.order.id);c=c.replaceAll("{amount}",this.formatMoney(o.order.amount)),l.querySelector(".ref-payment-method-instructions").innerHTML=c,this.step="instructions",this.update();return}window.location=this.getSuccessURL({order_id:o.order.id,secure_hash:o.order.secure_hash});return}}if(e.target.matches(".ref-zero-value-complete-order")){let r=await x(`/update-zero-cart/${this.key}/`,{method:"POST",body:s},!1);if(r.success&&r.orderCompleted&&r.orderID){window.location=this.getSuccessURL({order_id:r.orderID,secure_hash:r.secureHash});return}await this.refreshState(),this.update()}}catch(r){r.data&&r.data.errors&&(this.showFormErrors(this.shippingForm,r.data.errors),r.data.errors.system&&this.showSystemError("Couldn't update shipping details",r.data.errors.system))}finally{this.hideLoading()}}else this.shippingForm.reportValidity()}if(e.target.matches(".ref-add-code")){let s=this.couponInput.value.trim();if(this.couponError.textContent="",!s.length)return;this.showLoading();try{let r=new FormData;r.append("code",s),await x(`/add-coupon/${this.key}/`,{method:"POST",body:r},!1),this.couponInput.value="";let n=new E(a('<div data-reflow-type="toast"></div>'),{type:"success",title:"Купон добавлен!"});n.init(),n.show(),await this.refresh()}catch(r){((i=r==null?void 0:r.data)==null?void 0:i.errors["coupon-code"])&&(this.couponError.textContent=r.data.errors["coupon-code"])}finally{this.hideLoading()}}if(e.target.matches(".ref-coupon-input-clear")&&(this.couponInput.value="",this.couponButton.classList.add("inactive"),this.couponError.textContent=""),e.target.matches(".ref-remove-coupon")){if(!this.state.coupon)return;this.showLoading();try{await x(`/remove-coupon/${this.key}/`,{method:"POST"},!1);let s=new E(a('<div data-reflow-type="toast"></div>'),{type:"success",title:"Купон удален!"});s.init(),s.show(),await this.refresh()}catch(s){let r=new E(a('<div data-reflow-type="toast"></div>'),{type:"danger",title:"Coupon removal failed."});r.init(),r.show()}finally{this.hideLoading()}}}}onKeypress(e){e.keyCode==13&&e.target.matches(".ref-quantity-widget input")&&e.target.blur()}onShowbillingChange(e){let t=e.target.checked;this.billingVisible=!t,this.billingVisible&&!Object.keys(this.billingAddress).length&&Object.assign(this.billingAddress,this.shippingAddress),this.update()}onTaxExemptionChange(e){let t=this.taxNote.querySelector(".ref-tax-exemption-fields");t.style.display=e.target.checked?"block":"none",this.state.taxes.details.exemptionType=="file"&&(this.fileExemptionInput.disabled=!e.target.checked),this.state.taxes.details.exemptionType=="vat_number"&&(this.textExemptionInput.disabled=!e.target.checked,this.textExemptionInput.closest("label").querySelector("span").textContent="Enter your EU VAT number")}onShippingMethodHolderChange(e){this.shippingMethodIndex=e.target.value,this.refresh()}onCouponCodeInput(e){this.couponError.textContent="",e.target.value.length?(this.couponButton.classList.remove("inactive"),this.couponClear.style.display="block"):(this.couponButton.classList.add("inactive"),this.couponClear.style.display="none")}showFormErrors(e,t){for(let i in t){let s=e.querySelector(`[name=${i}]`);if(!s)continue;let n=(s.closest(".ref-error-parent")||s.closest("label")).querySelector(".ref-validation-error");n.textContent=Array.isArray(t[i])?t[i][0]:t[i]}}clearFormErrors(){for(let e of a(".ref-validation-error",this.node))e.textContent=""}getStep(){return this.step}setStep(e){T.steps.includes(e)&&(this.step=e)}getAddress(e){if(!["details","shipping","billing"].includes(e))return;let t={};this.shippingAddress.city&&(t.city=this.shippingAddress.city),this.shippingAddress.postcode&&(t.postcode=this.shippingAddress.postcode),this.shippingAddress.state&&(t.state=this.shippingAddress.state);let i=this.shippingAddress.country;if(!i)return;t.country=i;let s=this.getCountryByCode(i);if(!!s&&!(e=="details"&&s.has_regions&&(!t.state||s.has_postcode&&!t.postcode))&&!(e=="shipping"&&(!t.city||s.has_regions&&!t.state||s.has_postcode&&!t.postcode)))return t}getSuccessURL(e={}){try{if(!this.node.dataset.reflowSuccessUrl)throw Error("invalid");let t=new URL(this.node.dataset.reflowSuccessUrl,window.location.href),i=t.search;for(let s in e)i+=i.length?"&":"?",i+=`${s}=${e[s]}`;return t.search=i,t.href}catch(t){return window.location.href}}getCancelURL(){try{if(!this.node.dataset.reflowCancelUrl)throw Error("invalid");return new URL(this.node.dataset.reflowCancelUrl,window.location.href).href}catch(e){return window.location.href}}canShip(){return this.state.shipping.length&&!this.state.errors.filter(e=>e.type=="cannot-ship").length}hasZeroValue(){return this.state.total==0}canFinish(){return!this.state.errors.filter(e=>e.severity=="fatal").length}getStateError(e={}){if(e.message)return e.message;switch(e.type){case"out-of-stock":return"One or more products are out of stock!";case"unavailable-quantity":return"One or more products are unavailable!";case"cannot-ship":return"The products cannot be shipped to the provided address!";case"invalid-coupon":return"Invalid coupon in cart. Please remove the coupon to continue with checkout.";default:return""}}getStateErrors(){return(this.state.errors||[]).map(this.getStateError.bind(this)).filter(t=>!!t)}async updateAddress(e){let t=this.getAddress(e);if(!t)return;let i=new FormData;i.append("address",JSON.stringify(t)),this.clearFormErrors(),this.showLoading(),await x(`/update-address/${this.key}/`,{method:"POST",body:i},!1),await this.refresh()}getFooterLinks(){let e=[];if(this.state)for(let t of this.state.footerLinks){let i=document.createElement("a");i.textContent=t.name,i.href=t.url,i.target="_blank",e.push(i)}return e}hasPhysicalProducts(){if(this.state){for(let e of this.state.products)if(e.type=="physical"&&e.inStock)return!0}return!0}showMessage(e){this.message.style.display="block",this.message.textContent=e}resetView(){this.message.style.display="none",this.cart.style.display="none",this.checkout.style.display="none"}async refresh(){this.showLoading(),await this.refreshState(),this.hideLoading(),this.update()}renderProduct(e){let t=a(`
			<div class="ref-product">
				<div class="ref-product-col">
					<div class="ref-product-wrapper">
						<img class="ref-product-photo">
						<div class="ref-product-data">
							<div class="ref-product-info">
								<div class="ref-product-name"></div>
								<div class="ref-product-category"></div>
								<div class="ref-product-variants"></div>
								<div class="ref-product-personalization-holder"></div>
							</div>
							<div class="ref-product-price"></div>
						</div>
					</div>
					<div class="ref-product-controls">
						<div class="ref-product-quantity">
							<div class="ref-quantity-container"></div>
							<div class="ref-product-qty-message"></div>
							<div class="ref-product-remove">Удалить</div>
						</div>
						<div class="ref-product-total">
							<div class="ref-product-total-sum"></div>
						</div>
					</div>
				</div>
				<div class="ref-price-col">
					<div class="ref-product-price"></div>
				</div>
				<div class="ref-quantity-col">
					<div class="ref-product-quantity">
						<div class="ref-quantity-container"></div>
						<div class="ref-product-qty-message"></div>
						<div class="ref-product-remove">Удалить</div>
					</div>
				</div>
				<div class="ref-total-col">
					<div class="ref-product-total">
						<div class="ref-product-total-sum"></div>
					</div>
				</div>
			</div>
		`),i=e.name;if(t.dataset.id=e.id,t.dataset.quantity=e.quantity,e.variant){t.dataset.variant_id=e.variant.id;let d=a(".ref-product-variants",t)[0],p=a('<div class="ref-product-variant"></div>');p.textContent=e.variant.option_name+": "+e.variant.name,d.append(p)}if(e.personalization&&e.personalization.length)try{t.dataset.personalization=JSON.stringify(e.personalization.map(p=>{let h={id:p.id};return p.inputText&&(h.inputText=p.inputText),h}));let d=a(".ref-product-personalization-holder",t)[0];for(let p of e.personalization){let h=a('<div class="ref-product-personalization"></div>'),v=`${p.name}${p.inputText?': "'+p.inputText+'" ':""} ${p.price?"+"+this.formatMoney(p.price):"- Free"}`;h.title=v,v=v.length>55?v.substring(0,55)+"...":v,h.textContent=v,d.append(h)}}catch(d){console.error("Reflow:",d)}let s=a(".ref-product-photo",t)[0];s.src=e.image.sm,s.alt=i,a(".ref-product-name",t)[0].textContent=i;let r=a(".ref-product-price",t)||[];for(let d of r)d.textContent=this.formatMoney(e.unitPrice);if(e.inStock){if(e.quantity>e.availableQuantity)for(let d of a(".ref-product-qty-message",t))d.textContent=e.availableQuantity>0?`Only ${e.availableQuantity} left in stock.`:"0 items left in stock";else if(e.quantity>e.maxQty)for(let d of a(".ref-product-qty-message",t))d.textContent=`Maximum of ${e.maxQty} per customer`}let n=a(".ref-product-total-sum",t)||[];for(let d of n)e.inStock?d.textContent=this.formatMoney(e.price):(d.textContent="Out of Stock",d.classList.add("out-of-stock"));let o=a(".ref-product-quantity input",t)||[];for(let d of o)d.value=e.quantity;let l="Product";e.categories.length&&(l=e.categories[0].name),a(".ref-product-category",t)[0].textContent=l;let c=a(".ref-quantity-container",t)||[];for(let d of c){let p=new I(d,{inStock:e.inStock,onChange:h=>{let v=h.getProduct(),m=h.getQuantity(),y=h.getVariant(),P=t,w=new FormData,u=P.dataset.personalization;u&&u.length&&w.append("personalization",u),Reflow.cart.scheduleAPICall(v+(y?`-${y}`:"")+"-quantity",()=>Reflow.cart.updateProduct(v,m,y,w))}});p.init(),e.variant&&p.setVariant(e.variant.id),p.setProduct(e.id),p.setMaxQuantity(Math.min(e.availableQuantity,e.maxQty)),p.setQuantity(e.quantity),p.update()}return t}renderProductCompact(e){let t=a(`
			<div class="ref-product">
				<div class="ref-product-col">
					<img class="ref-product-photo">
					<div>
						<div class="ref-product-name"></div>
						<div class="ref-product-secondary"></div>
						<div class="ref-product-personalization-holder"></div>
						<div class="ref-product-qty-message"></div>
						<div class="ref-product-update-cart"></div>
					</div>
				</div>
				<div>
					<div class="ref-product-total"></div>
					<div class="ref-product-remove">Remove</div>
				</div>
			</div>
		`),i=e.name;t.dataset.id=e.id,e.variant&&(t.dataset.variant_id=e.variant.id,i+=` (${e.variant.name})`);let s=a(".ref-product-photo",t)[0];s.src=e.image.sm,s.alt=i,a(".ref-product-name",t)[0].textContent=i,a(".ref-product-secondary",t)[0].textContent=this.formatMoney(e.unitPrice)+" x "+e.quantity,e.inStock&&e.quantity>e.availableQuantity?(t.classList.add("ref-warning"),a(".ref-product-qty-message",t)[0].textContent=e.availableQuantity>0?`Only ${e.availableQuantity} left in stock.`:"0 left in stock",a(".ref-product-update-cart",t)[0].textContent="Update cart"):e.inStock&&e.quantity>e.maxQty?(t.classList.add("ref-warning"),a(".ref-product-qty-message",t)[0].textContent=`Maximum of ${e.maxQty} per customer`,a(".ref-product-update-cart",t)[0].textContent="Update cart"):(a(".ref-product-qty-message",t)[0].remove(),a(".ref-product-update-cart",t)[0].remove());let r=a(".ref-product-total",t)[0];if(e.inStock?(r.textContent=this.formatMoney(e.price),a(".ref-product-remove",t)[0].remove()):(r.textContent="Out of Stock",r.classList.add("out-of-stock")),e.personalization&&e.personalization.length){let n=a(".ref-product-personalization-holder",t)[0];for(let o of e.personalization){let l=a('<div class="ref-product-personalization"></div>'),c=`${o.name}${o.inputText?': "'+o.inputText+'"':""}`;l.title=c,c=c.length>25?c.substring(0,25)+"...":c,l.textContent=c,n.append(l)}}return t}renderShippingMethod(e,t){let i=a(`<label class="ref-row">
			<div class="ref-method-radio"><input type="radio" value="" name="shipping-method" required /></div>
			<div class="ref-method-name"></div>
			<div class="ref-method-price">$19.00</div>
		</label>`),s=a("input",i)[0];s.value=t,s.checked=e.chosen;let r=a(".ref-method-name",i)[0],n=document.createElement("b");if(n.textContent=e.name,r.append(n),e.note){let o=document.createElement("small");o.textContent=e.note,r.append(o)}return a(".ref-method-price",i)[0].textContent=this.formatMoney(e.price),i}formatMoney(e){return A(e,this.state.currencyConfig)}hasNextStep(){return T.steps.indexOf(this.step)<2}hasPreviousStep(){return T.steps.indexOf(this.step)>0}next(){let e=T.steps.indexOf(this.step);this.step=T.steps[e+1]}previous(){let e=T.steps.indexOf(this.step);this.step=T.steps[e-1]}get state(){return this.demoMode?this._state||null:this._state||Reflow.cart.state||null}set state(e=null){this._state=e}async refreshState(){if(this.mockData){this.state=this.mockData;return}let e={};this.shippingMethodIndex>=0&&(e.chosenShippingMethod=this.shippingMethodIndex),await Reflow.cart.refresh(e)}arePaymentProvidersAvailable(){return this.isStripeSupported()||this.isPaypalSupported()||this.hasCustomPayments()}isStripeSupported(){return this.state.paymentProviders.stripe.supported}isPaypalSupported(){return this.state.paymentProviders.paypal.supported}hasCustomPayments(){return Object.entries(this.state.paymentProviders).some(e=>e[1].provider=="custom")}updateCart(){var t;if(!this.state)return this.showMessage("Unable to load Корзина.");if(!this.state.products.length)return this.showMessage("Ваша корзина пустая.");this.cart.style.display="block",this.productTable.innerHTML="";for(let i of this.state.products)this.productTable.append(this.renderProduct(i));let e=this.cart.querySelector(".ref-links");e.innerHTML="";for(let i of this.getFooterLinks())e.append(i);if(this.cartSubtotal.textContent="Итого: "+this.formatMoney(this.state.subtotal),(t=this.state.vacationMode)==null?void 0:t.enabled){let i=this.cart.querySelector(".ref-checkout-button");if(i.classList.add("inactive"),this.state.vacationMode.message.length){let s=a('<div class="ref-store-message"></div>');s.textContent=this.state.vacationMode.message,this.cart.querySelector(".ref-totals").insertBefore(s,i)}}}updateCheckout(){var P,w;this.checkout.style.display="flex";let e=this.checkout.querySelector(".ref-details"),t=this.checkout.querySelector(".ref-shipping-payment"),i=this.checkout.querySelector(".ref-instructions");e.style.display="none",t.style.display="none",i.style.display="none";let s=null;this.step=="details"?(e.style.display="block",s=this.detailsForm):this.step=="shipping"?(t.style.display="block",s=this.shippingForm):this.step=="instructions"&&(i.style.display="block"),e.querySelector(".ref-shipping-address-holder").append(this.detailsAddressWidget.update(!0,!0)),(this.isStripeSupported()||this.hasCustomPayments()||this.hasZeroValue())&&(t.querySelector(".ref-shipping-address-holder").append(this.shippingAddressWidget.update(!0,!0)),t.querySelector(".ref-billing-address-holder").append(this.billingAddressWidget.update(!0,!0))),this.shippingAddress.country&&!this.canShip()&&this.showFormErrors(s,{"shipping-country":["The store is unable to ship your order to this address."]});let r=this.checkout.querySelector(".ref-products");r.innerHTML="";for(let u of this.state.products)r.append(this.renderProductCompact(u));let n=this.checkout.querySelector(".ref-subtotal");n.firstElementChild.children[1].textContent=this.formatMoney(this.state.subtotal),this.couponCode.classList.remove("hidden"),this.couponCode.nextElementSibling.style.display="block";let o=this.checkout.querySelector(".ref-applied-coupon");if(o.style.display="none",this.state.coupon){this.couponCode.classList.add("hidden"),this.couponCode.nextElementSibling.style.display="none",this.couponError.textContent="",o.style.display="block";let u=this.state.coupon,b=u.name||u.code.toUpperCase();b.length>15&&(b=b.substring(0,15)+"..."),o.firstElementChild.firstElementChild.children[0].textContent=b,o.firstElementChild.children[1].textContent=u.error?"":"-"+this.formatMoney(this.state.discount),o.querySelector(".ref-applied-coupon-error").textContent=u.error||""}this.step=="instructions"&&(this.couponCode.classList.add("hidden"),this.couponCode.nextElementSibling.style.display="none",o.querySelector(".ref-remove-coupon").style.display="none");let l=this.checkout.querySelector(".ref-shipping");if(l.style.display="none",this.hasPhysicalProducts()){l.style.display="block";let u=null;for(let C of this.state.shipping)C.chosen&&(u=C);let b="Доставка",L="";u?(b=`Доставка (${u.name})`,L=this.formatMoney(u.price)):(L="Not yet selected",this.step=="details"&&(L="Selected on next step")),l.firstElementChild.children[0].textContent=b,l.firstElementChild.children[1].textContent=L}let c=this.checkout.querySelector(".ref-total");c.firstElementChild.children[1].textContent=this.formatMoney(this.state.total),this.checkout.querySelector(".ref-total-note span").textContent=this.state.currency,this.taxNote.style.display="none";let d=this.checkout.querySelector(".ref-taxes");if(d.style.display="none",this.fileExemptionInput.disabled=!0,this.textExemptionInput.disabled=!0,this.state.taxes){let u=this.state.taxes.details,b=u.taxRate,L=d.querySelectorAll("span");if(L[0].textContent=`${b.name} (${b.rate}%)`+(u.exemption?" \u2013 "+u.exemption:""),L[1].textContent=this.formatMoney(this.state.taxes.amount),d.style.display="block",u.exemptionType){this.taxNote.style.display="block",this.taxExemptionCheckbox.checked=!1,this.taxExemptionCheckbox.nextElementSibling.textContent="I have a tax exemption";let C=this.taxNote.querySelector(".ref-tax-exemption-fields");C.style.display="none",u.exemption&&(this.taxExemptionCheckbox.checked=!0,C.style.display="block");let S=this.taxNote.querySelectorAll("label");if(S[1].style.display="none",S[2].style.display="none",u.exemptionType=="file"){let k=S[1].querySelector("span");k.textContent="Attach a document or photo of your tax exemption",S[1].style.display="block",u.exemption&&(this.fileExemptionInput.disabled=!1)}if(u.exemptionType=="vat_number"){this.taxExemptionCheckbox.nextElementSibling.textContent="I have a VAT number";let k=S[2].querySelector("span");k.textContent="Enter your EU VAT number",S[2].style.display="block",u.exemptionValue&&(this.textExemptionInput.disabled=!1,this.textExemptionInput.value=u.exemptionValue)}}}this.noteToSeller.classList.remove("open"),this.state.note&&this.noteToSeller.classList.add("open"),this.acceptTerms.innerHTML="";let p,h=this.state.footerLinks;for(let u=0;u<h.length;u++){let b=h[u];if((b.name=="Terms & Conditions"||b.name=="Privacy Policy"||b.name=="Refund Policy")&&b.required){p?p.append(a("<span>"+(u===h.length-1?" и ":", ")+"</span>")):(p=a('<label for="ref-terms-agreement">'),p.append(a("<span>Я принимаю </span>")));let L=a("<a>");L.href=b.url,L.textContent=b.name,p.append(L)}}p&&(this.acceptTerms.append(a('<input type="checkbox" id="ref-terms-agreement" required>')),this.acceptTerms.append(p),this.acceptTerms.append(a("<hr>")));let v=this.checkout.querySelector(".ref-links");v.innerHTML="";for(let u of this.getFooterLinks())v.append(u);let m=this.node.querySelector(".ref-express");!this.isPaypalSupported()||((P=this.state.vacationMode)==null?void 0:P.enabled)?m&&m.remove():(m.style.display="block",this.hasZeroValue()&&(m.style.display="none"));let y=this.node.querySelector(".ref-standard");if(y.style.display="block",!this.isStripeSupported()&&!this.hasCustomPayments()&&!this.hasZeroValue())y.style.display="none";else{this.billingSameAsShipping.checked=!this.billingVisible;let u=this.node.querySelector("fieldset.ref-billing-address");if(u.style.display="none",u.disabled=!0,this.billingVisible&&(u.style.display="block",u.disabled=!1),this.shippingMethodHeading.style.display="none",this.shippingMethodHolder.innerHTML="",this.state.shipping.length){this.shippingMethodHeading.style.display="block";for(let b=0,L=this.state.shipping;b<L.length;b++)this.shippingMethodHolder.append(this.renderShippingMethod(L[b],b,!1));this.shippingMethodHolder.append(a('<div class="ref-validation-error"></div>'))}if(this.standardPaymentButtonHolder.innerHTML="",this.hasZeroValue()){let b=document.createElement("div");b.className="ref-button ref-zero-value-complete-order",b.textContent="Оплатить заказ",this.standardPaymentButtonHolder.append(b)}else{let b=Object.entries(this.state.paymentProviders).sort((L,C)=>C[1].order-L[1].order);for(let[L,C]of b)if(C.provider!="paypal"){if(C.provider=="stripe"&&C.supported&&C.paymentOptions.length)for(let S of C.paymentOptions)if(S.id=="card"){let k=document.createElement("div");k.className="ref-button ref-proceed-stripe-payment",k.textContent="Credit Card",this.standardPaymentButtonHolder.append(k),k=k.cloneNode(),k.textContent="Apple Pay / Google Pay",this.standardPaymentButtonHolder.append(k)}else{let k=document.createElement("div");k.className="ref-button ref-proceed-stripe-payment",k.textContent=S.name,this.standardPaymentButtonHolder.append(k)}if(C.provider=="custom"){let S=document.createElement("div");S.className="ref-button ref-complete-order",S.dataset.paymentMethod=C.id,S.textContent=C.name,this.standardPaymentButtonHolder.append(S)}}}}if(this.isDemoMode()){this.node.querySelectorAll(".ref-proceed-stripe-payment, .ref-complete-order").forEach(u=>u.classList.add("button-demo-payment")),this.node.querySelector(".ref-paypal-button-holder").innerHTML=`<div class="paypal-button paypal-button-gold button-demo-payment">
				<svg xmlns="http://www.w3.org/2000/svg" height="22" viewBox="0 0 101 32" preserveAspectRatio="xMinYMin meet"><path fill="#003087" d="M 12.237 2.8 L 4.437 2.8 C 3.937 2.8 3.437 3.2 3.337 3.7 L 0.237 23.7 C 0.137 24.1 0.437 24.4 0.837 24.4 L 4.537 24.4 C 5.037 24.4 5.537 24 5.637 23.5 L 6.437 18.1 C 6.537 17.6 6.937 17.2 7.537 17.2 L 10.037 17.2 C 15.137 17.2 18.137 14.7 18.937 9.8 C 19.237 7.7 18.937 6 17.937 4.8 C 16.837 3.5 14.837 2.8 12.237 2.8 Z M 13.137 10.1 C 12.737 12.9 10.537 12.9 8.537 12.9 L 7.337 12.9 L 8.137 7.7 C 8.137 7.4 8.437 7.2 8.737 7.2 L 9.237 7.2 C 10.637 7.2 11.937 7.2 12.637 8 C 13.137 8.4 13.337 9.1 13.137 10.1 Z"/><path fill="#003087" d="M 35.437 10 L 31.737 10 C 31.437 10 31.137 10.2 31.137 10.5 L 30.937 11.5 L 30.637 11.1 C 29.837 9.9 28.037 9.5 26.237 9.5 C 22.137 9.5 18.637 12.6 17.937 17 C 17.537 19.2 18.037 21.3 19.337 22.7 C 20.437 24 22.137 24.6 24.037 24.6 C 27.337 24.6 29.237 22.5 29.237 22.5 L 29.037 23.5 C 28.937 23.9 29.237 24.3 29.637 24.3 L 33.037 24.3 C 33.537 24.3 34.037 23.9 34.137 23.4 L 36.137 10.6 C 36.237 10.4 35.837 10 35.437 10 Z M 30.337 17.2 C 29.937 19.3 28.337 20.8 26.137 20.8 C 25.037 20.8 24.237 20.5 23.637 19.8 C 23.037 19.1 22.837 18.2 23.037 17.2 C 23.337 15.1 25.137 13.6 27.237 13.6 C 28.337 13.6 29.137 14 29.737 14.6 C 30.237 15.3 30.437 16.2 30.337 17.2 Z"/><path fill="#003087" d="M 55.337 10 L 51.637 10 C 51.237 10 50.937 10.2 50.737 10.5 L 45.537 18.1 L 43.337 10.8 C 43.237 10.3 42.737 10 42.337 10 L 38.637 10 C 38.237 10 37.837 10.4 38.037 10.9 L 42.137 23 L 38.237 28.4 C 37.937 28.8 38.237 29.4 38.737 29.4 L 42.437 29.4 C 42.837 29.4 43.137 29.2 43.337 28.9 L 55.837 10.9 C 56.137 10.6 55.837 10 55.337 10 Z"/><path fill="#009cde" d="M 67.737 2.8 L 59.937 2.8 C 59.437 2.8 58.937 3.2 58.837 3.7 L 55.737 23.6 C 55.637 24 55.937 24.3 56.337 24.3 L 60.337 24.3 C 60.737 24.3 61.037 24 61.037 23.7 L 61.937 18 C 62.037 17.5 62.437 17.1 63.037 17.1 L 65.537 17.1 C 70.637 17.1 73.637 14.6 74.437 9.7 C 74.737 7.6 74.437 5.9 73.437 4.7 C 72.237 3.5 70.337 2.8 67.737 2.8 Z M 68.637 10.1 C 68.237 12.9 66.037 12.9 64.037 12.9 L 62.837 12.9 L 63.637 7.7 C 63.637 7.4 63.937 7.2 64.237 7.2 L 64.737 7.2 C 66.137 7.2 67.437 7.2 68.137 8 C 68.637 8.4 68.737 9.1 68.637 10.1 Z"/><path fill="#009cde" d="M 90.937 10 L 87.237 10 C 86.937 10 86.637 10.2 86.637 10.5 L 86.437 11.5 L 86.137 11.1 C 85.337 9.9 83.537 9.5 81.737 9.5 C 77.637 9.5 74.137 12.6 73.437 17 C 73.037 19.2 73.537 21.3 74.837 22.7 C 75.937 24 77.637 24.6 79.537 24.6 C 82.837 24.6 84.737 22.5 84.737 22.5 L 84.537 23.5 C 84.437 23.9 84.737 24.3 85.137 24.3 L 88.537 24.3 C 89.037 24.3 89.537 23.9 89.637 23.4 L 91.637 10.6 C 91.637 10.4 91.337 10 90.937 10 Z M 85.737 17.2 C 85.337 19.3 83.737 20.8 81.537 20.8 C 80.437 20.8 79.637 20.5 79.037 19.8 C 78.437 19.1 78.237 18.2 78.437 17.2 C 78.737 15.1 80.537 13.6 82.637 13.6 C 83.737 13.6 84.537 14 85.137 14.6 C 85.737 15.3 85.937 16.2 85.737 17.2 Z"/><path fill="#009cde" d="M 95.337 3.3 L 92.137 23.6 C 92.037 24 92.337 24.3 92.737 24.3 L 95.937 24.3 C 96.437 24.3 96.937 23.9 97.037 23.4 L 100.237 3.5 C 100.337 3.1 100.037 2.8 99.637 2.8 L 96.037 2.8 C 95.637 2.8 95.437 3 95.337 3.3 Z"/></svg>
			</div>
			<div class="paypal-button paypal-button-black button-demo-payment">
				<svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 18"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-3.000000, -6.000000)" fill="#ffffff" fill-rule="nonzero"><path d="M8.27521338,12.5122653 C7.93003542,12.5122653 7.65021338,12.2324432 7.65021338,11.8872653 C7.65021338,11.5420873 7.93003542,11.2622653 8.27521338,11.2622653 L24.7879042,11.2622653 C25.5955939,11.2622653 26.25,11.9175905 26.25,12.7255368 L26.25,22.2867284 C26.25,23.0946748 25.5955939,23.75 24.7879042,23.75 L5.21231302,23.75 C4.40462325,23.75 3.75,23.0946748 3.75,22.2867397 L3.75,7.71327152 C3.75,6.90532518 4.40440608,6.25 5.21227212,6.25 L24.7880664,6.25552163 C25.5956079,6.25573147 26.25,6.91099507 26.25,7.71870362 L26.25,9.23577161 C26.25,9.58094958 25.9702675,9.86081168 25.6250895,9.86086112 C25.2799115,9.86091055 25.0000494,9.5811286 25,9.23595063 L24.9997827,7.71879313 C24.9997827,7.60083189 24.9046611,7.50555197 24.7877278,7.50552158 L5.21209583,7.49999998 C5.09515506,7.49999998 5,7.59528868 5,7.71326028 L5.00021718,22.2867284 C5.00021718,22.4047113 5.09537223,22.5 5.21231302,22.5 L24.7879042,22.5 C24.904845,22.5 25,22.4047113 25,22.2867284 L25,12.7255368 C25,12.607554 24.9048449,12.5122653 24.7879042,12.5122653 L8.27521338,12.5122653 Z" id="Stroke-1"/></g></g></svg>
				Дебетовая или кредитная карта
			</div>`;return}this.paypalButtonsInitialized||((w=this.state.vacationMode)==null?void 0:w.enabled)||this.isPaypalSupported()&&(this.getPaypalInstance().then(u=>{let b=[u.FUNDING.PAYPAL];this.isStripeSupported()||b.push(u.FUNDING.CARD);for(let L of b)u.Buttons({fundingSource:L,createOrder:this.paypalCreateOrder.bind(this),onApprove:this.paypalOnApprove.bind(this),onError:this.paypalError.bind(this),onShippingChange:this.paypalShippingChange.bind(this),onCancel:this.paypalCancel.bind(this)}).render(this.node.querySelector(".ref-paypal-button-holder"))}),this.paypalButtonsInitialized=!0)}async paypalCreateOrder(e,t){if(await this.refreshState(),this.update(),!this.canFinish()){this.showSystemError("Error",this.getStateErrors()[0]);return}return(await x(`/create-paypal-order/${this.key}/`,{method:"POST"},!1)).orderID}async paypalOnApprove(e,t){let i=new FormData;i.append("orderID",e.orderID);try{let s=await x(`/capture-paypal-order/${this.key}/`,{method:"POST",body:i},!1);window.location=this.getSuccessURL({order_id:s.orderID,secure_hash:s.secureHash})}catch(s){if(!s.data)throw s;let r=s.data,n=Array.isArray(r.details)&&r.details[0];if(n&&n.issue==="INSTRUMENT_DECLINED")return t.restart();throw s}}async paypalShippingChange(e,t){try{let i=new FormData;i.append("orderID",e.orderID),i.append("address",JSON.stringify(e.shipping_address));let s=0;e.selected_shipping_option&&e.selected_shipping_option.id&&(s=e.selected_shipping_option.id),i.append("selectedShippingOption",s);let r=await x(`/update-paypal-shipping/${this.key}/`,{method:"POST",body:i},!1);return t.resolve()}catch(i){let s=i.data&&i.data.errors&&i.data.errors.system||"";return this.showSystemError("Couldn't update PayPal shipping",s),console.error("Reflow:",i),t.reject()}}paypalCancel(e){this.refresh()}paypalError(e){console.error("Reflow:",e),!!this.canFinish()&&setTimeout(function(){window.alert("Извините, ваша транзакция не может быть обработана. Пожалуйста, попробуйте еще раз.")},1e3)}showLoading(){this.loadingOverlay.classList.add("visible"),this.toShippingPageButton.setAttribute("data-disabled-click",!0),this.node.querySelectorAll(".ref-proceed-stripe-payment, .ref-complete-order, .ref-zero-value-complete-order").forEach(e=>e.setAttribute("data-disabled-click",!0)),this.couponButton.setAttribute("data-disabled-click",!0)}hideLoading(){this.loadingOverlay.classList.remove("visible"),this.toShippingPageButton.removeAttribute("data-disabled-click"),this.node.querySelectorAll(".ref-proceed-stripe-payment, .ref-complete-order, .ref-zero-value-complete-order").forEach(e=>e.removeAttribute("data-disabled-click")),this.couponButton.removeAttribute("data-disabled-click")}saveFocus(){this.savedFocusTarget=document.activeElement}restoreFocus(){this.savedFocusTarget&&(this.savedFocusTarget.focus(),this.savedFocusTarget=null)}async update(){if(this.saveFocus(),this.resetView(),!T.steps.includes(this.step))throw new Error("Invalid Step: "+this.step);if(!this.state)try{await this.refreshState(),this.restoreUserInput()}catch(e){this.showMessage("Unable to load Корзина.");return}if(!this.arePaymentProvidersAvailable()){this.showMessage("This store has no payment methods configured.");return}(this.step=="details"||this.step=="shipping"||this.step=="instructions")&&(this.state.products.length?this.updateCheckout():this.step="cart"),this.step=="cart"&&this.updateCart(),this.restoreFocus()}},$=T;g($,"type","shopping-cart"),g($,"steps",["cart","details","shipping","instructions"]);var U=class{constructor(e){this.options=e,this.model=e.model;let t=e.fieldPrefix;this.countryOnly=e.countryOnly||!1;let i='<div class="ref-address-widget">';this.countryOnly||(i+=`<label>
				<span>Имя</span>
				<input type="text" class="ref-form-control ref-field-details-name" value="" name="${t}-name" required minlength="5" />
				<div class="ref-validation-error"></div>
			</label>
			<label>
				<span>Адрес</span>
				<textarea row="2" class="ref-form-control ref-field-details-address-line" name="${t}-address" required minlength="5"></textarea>
				<div class="ref-validation-error"></div>
			</label>
			<label>
				<span>Город</span>
				<input type="text" class="ref-form-control ref-field-details-city" value="" name="${t}-city" required minlength="2" />
				<div class="ref-validation-error"></div>
			</label>`),i+=`<div class="ref-error-parent">
			<label>
				<span>Страна</span>
				<select class="ref-form-control ref-field-details-country" name="${t}-country" required></select>
			</label>
			<div class="ref-row ref-row-region">
				<label>
					<span>Штат</span>
					<select class="ref-form-control ref-field-details-region" name="${t}-state" required></select>
				</label>
				<label>
					<span>Почтовый индекс</span>
					<input type="text" class="ref-form-control ref-field-details-postcode" name="${t}-postcode" value="" required />
				</label>
			</div>
			<div class="ref-validation-error"></div>
		</div>`,i+="</div>",this.node=a(i),this.countrySelect=this.node.querySelector(".ref-field-details-country"),this.regionSelect=this.node.querySelector(".ref-field-details-region"),this.postcodeField=this.node.querySelector(".ref-field-details-postcode").parentNode,this.postcodeInput=this.postcodeField.querySelector("input"),this.stateField=this.regionSelect.parentNode,this.postcodeInput.addEventListener("change",this.onPostcodeInput.bind(this)),this.countrySelect.addEventListener("change",this.onCountryChange.bind(this)),this.regionSelect.addEventListener("change",this.onRegionChange.bind(this)),this.countryOnly||(this.nameInput=this.node.querySelector(".ref-field-details-name"),this.addressLineInput=this.node.querySelector(".ref-field-details-address-line"),this.cityInput=this.node.querySelector(".ref-field-details-city"),this.nameInput.addEventListener("change",this.onNameChange.bind(this)),this.addressLineInput.addEventListener("change",this.onAddressLineChange.bind(this)),this.cityInput.addEventListener("change",this.onCityChange.bind(this)))}onNameChange(e){this.model.name=e.target.value.trim()}onAddressLineChange(e){this.model.address=e.target.value.trim()}onCityChange(e){this.model.city=e.target.value.trim(),this.onChange()}onCountryChange(e){this.model.state="",this.model.country=e.target.value,this.update(!1,!0),this.onChange()}onRegionChange(e){this.model.state=e.target.value,this.onChange()}onPostcodeInput(e){this.model.postcode=e.target.value.trim(),this.onChange()}onChange(){this.options.onChange&&this.options.onChange()}getCountryByCode(e){return e?this.options.getCountries().find(t=>t.country_code==e):null}getCountries(){return this.options.getCountries()}update(e=!1,t=!1){if(this.countryOnly||(this.nameInput.value=this.model.name||"",this.addressLineInput.value=this.model.address||"",this.cityInput.value=this.model.city||""),e){this.countrySelect.innerHTML='<option value="">Выберите страну</option>';for(let s of this.getCountries()){let r=a(`<option value="${s.country_code}">${s.country_name}</option>`);s.country_code==this.model.country&&(r.selected=!0),this.countrySelect.append(r)}}this.postcodeField.style.display="none",this.stateField.style.display="none",this.postcodeInput.disabled=!0,this.regionSelect.disabled=!0;let i=this.getCountryByCode(this.model.country);if(this.model.country&&i){let s=i.has_postcode;if(this.options.hidePostCodeIfNoRegion&&!i.has_regions&&(s=!1),s&&(this.postcodeField.style.display="block",this.postcodeInput.disabled=!1,this.postcodeInput.value=this.model.postcode||"",this.postcodeField.querySelector("label span").textContent=i.postcode_title||"Почтовый индекс"),i.has_regions&&(this.stateField.style.display="block",this.regionSelect.disabled=!1,this.stateField.querySelector("label span").textContent=i.region_title,e||t)){this.regionSelect.innerHTML=`<option value="">Select ${i.region_title}</option>`;for(let[r,n]of Object.entries(i.regions)){let o=a(`<option value="${r}">${n}</option>`);r==this.model.state&&(o.selected=!0),this.regionSelect.append(o)}}}return this.node}},re=$;var W=class extends q{constructor(e,t){super(e,t);e.innerHTML='<div class="ref-product-controls"></div>',this.button=a('<a href="#" class="ref-button"></a>'),this.controls=e.querySelector(".ref-product-controls"),this.onVariantChange=t==null?void 0:t.onVariantChange,this.personalizationValues={}}init(){this.node.addEventListener("change",this.onChange.bind(this)),this.node.addEventListener("click",async e=>{if(!e.target.matches(".ref-button"))return;if(e.preventDefault(),!this.node.dataset.reflowProduct||!parseInt(this.node.dataset.reflowProduct,10)){console.error("Reflow: Добавить в корзину button is missing a product");return}let t=parseInt(this.node.dataset.reflowProduct,10),i=this.node.dataset.reflowVariant||null,s=this.node.dataset.reflowQuantity||1,r=[];for(let o of this.node.querySelectorAll(".ref-personalization-checkbox:checked"))if(o.id){let l={id:o.id},c=o.closest(".ref-personalization").querySelector("input[type=text]");if(c){let d=c.value.trim();if(!d.length){this.notification=new E(a('<div data-reflow-type="toast"></div>'),{type:"error",title:"Please add personalization text."}),this.notification.init(),this.notification.show();return}l.inputText=d}r.push(l)}let n=new FormData;r.length&&n.append("personalization",JSON.stringify(r));try{let o=await Reflow.cart.addProduct(t,s,i,n),l=this.getCartURL(),c={type:"success",title:"Товар добавлен в корзину"};l&&(c.button="Посмотреть",c.buttonAction=()=>{window.location.href=l}),this.notification=new E(a('<div data-reflow-type="toast"></div>'),c),this.notification.init(),this.notification.show(),this.setQuantity(1);let d=this.node.querySelector(".ref-quantity-widget input");d&&(d.value=1),this.personalizationValues={},this.update()}catch(o){let l=o.data&&o.data.errors&&o.data.errors.system||"";this.notification=new E(a('<div data-reflow-type="toast"></div>'),{type:"error",title:"Couldn't add product to cart",description:l}),this.notification.init(),this.notification.show(),console.error("Reflow: Couldn't add product to cart",o)}})}onChange(e){if(e.target.matches(".ref-field-variants")){this.setVariant(e.target.value),this.onVariantChange&&this.onVariantChange();return}if(e.target.matches(".ref-quantity-widget input")){this.setQuantity(e.target.value);return}if(e.target.matches(".ref-personalization-checkbox")){let t=e.target.closest(".ref-personalization").querySelector(".ref-instructions");t&&(t.style.display=e.target.checked?"block":"none");let i=e.target.closest(".ref-personalization").querySelector("input[type=text]");i&&(i.style.display=e.target.checked?"block":"none"),this.setPersonalizationInput(e.target.id,"checkbox",e.target.checked);return}e.target.matches(".ref-personalization-text-input")&&this.setPersonalizationInput(e.target.dataset.personalizationId,"text",e.target.value)}getAPIEndpoint(){if(!this.node.dataset.reflowProduct)throw new Error("ID for product missing");return"/products/"+parseInt(this.node.dataset.reflowProduct,10)}getProduct(){return this.node.dataset.reflowProduct}setProduct(e){this.node.dataset.reflowProduct=e}getQuantity(){return this.node.dataset.reflowQuantity||1}setQuantity(e=1){this.node.dataset.reflowQuantity=e}getVariant(){return this.node.dataset.reflowVariant}setVariant(e){this.node.dataset.reflowVariant=e}setText(e){this.button.textContent=e}getCartURL(){return this.node.dataset.reflowShoppingcartUrl}setCartURL(e){this.node.dataset.reflowShoppingcartUrl=e}activate(){this.button.classList.remove("inactive")}deactivate(){this.button.classList.add("inactive")}setPersonalizationInput(e,t,i){this.personalizationValues[e]||(this.personalizationValues[e]={}),this.personalizationValues[e][t]=i}getPersonalizationInput(e,t){return!this.personalizationValues[e]||!this.personalizationValues[e][t]?null:this.personalizationValues[e][t]}async update(e){var s;if(!e)try{e=await this.fetchData()}catch(r){throw this.node.innerHTML="This product doesn't exist.",r}let t=this.node.dataset.reflowAddtocartText||"Добавить в корзину";e.inStock||(t="Out of Stock"),this.setText(t),this.setProduct(e.id),this.activate();let i=this.parseShowString();if(this.controls.innerHTML="",!e.inStock)this.deactivate();else if((s=e.vacationMode)==null?void 0:s.enabled){if(this.deactivate(),e.vacationMode.message.length){let r=a('<div class="ref-store-message"></div>');r.textContent=e.vacationMode.message,this.node.prepend(r)}}else{if((i.full||i.variants)&&e.variants.variants&&e.variants.variants.length){let r=a('<div class="ref-variant"></div>'),n=a("<label></label>"),o=a("<span></span>");o.textContent=e.variants.option_name||"",n.append(o);let l=a('<select class="ref-form-control ref-field-variants" name="variant-state" required></select>');for(let c of e.variants.variants){let d=a("<option></option>");d.value=c.id,d.textContent=c.name,c.in_stock||(d.disabled=!0),l.append(d)}this.getVariant()&&(l.value=this.getVariant()),l.value&&this.setVariant(l.value),n.append(l),r.append(n),this.controls.append(r)}if(i.full||i.quantity){let r=a("<span></span>"),n=new I(r,{inStock:!0,onChange:l=>{this.setQuantity(l.getQuantity())}});n.init();let o=Math.min(e.availableQuantity,e.maxQty);if(this.getVariant()&&e.variants.variants){let l=e.variants.variants.find(c=>c.id==this.getVariant());l&&(o=Math.min(l.availableQuantity,e.maxQty),n.setVariant(this.getVariant()))}n.setProduct(this.getProduct()),n.setMaxQuantity(o),n.setQuantity(this.getQuantity()),n.update(),this.controls.append(r)}if(e.personalization&&e.personalization.length&&(i.full||i.personalization)){let r=a('<div class="ref-personalization-holder"></div>');for(let n of e.personalization){let o=a('<div class="ref-personalization"></div>'),l=!!this.getPersonalizationInput(n.id,"checkbox"),c=a('<span class="ref-row"></span>'),d=a("<div></div>"),p=a('<label class="ref-personalization-label"></label>');p.textContent=n.name;let h=a('<input type="checkbox" class="ref-form-control ref-personalization-checkbox"></input>');h.id=n.id,h.checked=l,d.append(p),p.append(h);let v=a('<span class="ref-price"></span>');if(v.textContent=n.priceFormatted,c.append(d),c.append(v),o.append(c),n.instructions&&n.instructions.length){let m=a('<p class="ref-instructions"></p>');m.textContent=n.instructions,m.style.display=l?"block":"none",o.append(m)}if(n.type=="text"){let m=a('<input type="text" class="ref-form-control ref-personalization-text-input"></input>');m.style.display=l?"block":"none",m.dataset.personalizationId=n.id,o.append(m);let y=this.getPersonalizationInput(n.id,"text");y&&(m.value=y)}r.append(o)}this.controls.append(r)}}if((i.full||i.button)&&(this.controls.append(this.button),e.minQty>0)){let r=a('<p class="ref-min-qty-message"></p>');r.textContent="Minimum Per Order is "+e.minQty,this.controls.append(r)}}};g(W,"type","add-to-cart");var _=W;var Te=/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/,ne=f=>f.match(Te)[1],oe=f=>{let e=ne(f);return{sm:"https://img.youtube.com/vi/"+e+"/default.jpg",md:"https://img.youtube.com/vi/"+e+"/mddefault.jpg",lg:"https://img.youtube.com/vi/"+e+"/hqdefault.jpg"}},Z=f=>"https://www.youtube.com/embed/"+ne(f),le=(f,e,t=[])=>{var i=document.getElementById(f);i&&i.tagName.toUpperCase()!="IFRAME"&&(i=i.getElementsByTagName("iframe")[0]),i&&i.contentWindow.postMessage(JSON.stringify({event:"command",func:e,args:t}),"*")};var O=class extends q{constructor(e,t){super(e,t);let i=a('<span data-reflow-type="add-to-cart"></span>');this.addToCart=new _(i,{onVariantChange:this.update.bind(this)})}init(){this.node.addEventListener("click",this.onClick.bind(this)),this.addToCart.init()}onClick(e){if(e.target.matches(".ref-thumbnails .ref-image")){let t=a(".ref-thumbnails .ref-image",this.node),i=Array.from(t).indexOf(e.target);this.previewItem(i)}e.target.closest(".ref-preview")&&this.gallery&&this.gallery.openAt(this.activeIndex)}previewItem(e=0){let t=a(".ref-preview .ref-image",this.node),i=t[this.activeIndex];i&&i.dataset.reflowPreviewType==="video"&&le("preview-"+this.activeIndex,"pauseVideo"),this.activeIndex=e;let s=a(".ref-thumbnails .ref-image",this.node),r=s[e];s.forEach(n=>n.classList.remove("active")),r.classList.add("active"),t.forEach(n=>n.classList.remove("active")),t[e]&&t[e].classList.add("active")}getAPIEndpoint(){let e=this.node.dataset.reflowProduct||new URL(location.href).searchParams.get("product");if(e)return"/products/"+parseInt(e,10);throw new Error("ID for product missing")}getCartURL(){return this.node.dataset.reflowShoppingcartUrl}setCartURL(e){this.node.dataset.reflowShoppingcartUrl=e}renderLightboxGallery(e){this.isDemoMode()||(this.gallery?this.gallery.setElements(e):this.getLightboxInstance().then(t=>{this.gallery=t({loop:!0,elements:e})}))}async getLightboxInstance(){return window.GLightbox?window.GLightbox:(O._glightboxPromise||(O._glightboxPromise=new Promise((e,t)=>{let i=[];i.push(new Promise((s,r)=>{let n=document.createElement("script");n.onload=()=>s(),n.onerror=o=>r(o),document.body.append(n),n.src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox@3.1.0/dist/js/glightbox.min.js"})),i.push(new Promise((s,r)=>{let n=document.createElement("link");n.onload=()=>s(),n.onerror=o=>r(o),document.head.append(n),n.rel="stylesheet",n.href="https://cdn.jsdelivr.net/gh/mcstudios/glightbox@3.1.0/dist/css/glightbox.min.css"})),Promise.all(i).then(()=>e(window.GLightbox)).catch(t)})),O._glightboxPromise)}async update(){var o;let e,t=null;try{e=await this.fetchData()}catch(l){throw this.node.innerHTML="This product doesn't exist.",l}((o=e.variants)==null?void 0:o.variants)&&(t=e.variants.variants.find(l=>!!l.in_stock),this.addToCart.getVariant()&&(t=e.variants.variants.find(l=>l.id==this.addToCart.getVariant())));let i=this.parseShowString(),s=a('<div class="reflow-product"></div>');if(i.full||i.media){let l=a('<div class="ref-media"></div>'),c=a('<div class="ref-preview"></div>');if(l.append(c),!e.media.length){var r=a('<img class="ref-image active">');r.src=e.image.md,c.append(r)}let d=[],p=this.activeIndex||0,h=e.media.length>1,v=a('<div class="ref-thumbnails"></div>');if(h&&l.append(v),t){let m=e.media.findIndex(y=>y.id==t.image);p=m>=0?m:p}for(let m=0;m<e.media.length;m++){let y=e.media[m],P=a('<div class="ref-thumbnail"></div>'),w=a('<div class="ref-image"></div>');w.dataset.reflowPreviewType=y.type;let u;if(y.type=="image")w.style.backgroundImage=`url('${y.src.sm}')`,w.dataset.reflowPreview=y.url,u=a('<img class="ref-image">'),u.src=y.src.md,u.dataset.reflowPreviewType=y.type,d.push({href:y.src.lg,type:"image"});else{let b=oe(y.url);w.classList.add("ref-video"),w.style.backgroundImage=`url('${b.sm}')`,w.dataset.reflowPreview=Z(y.url),u=a(`
						<iframe id="preview-${m}"
							class="ref-image ref-video"
							frameborder="0"
							allowfullscreen="true"
							src="${Z(y.url)}?enablejsapi=1">
						</iframe>`),u.dataset.reflowPreviewType=y.type,d.push({href:y.url,type:"video",source:"youtube",width:900})}c.append(u),P.append(w),v.append(P),p==m&&(this.activeIndex=m,w.classList.add("active"),u.classList.add("active"))}this.renderLightboxGallery(d),s.append(l)}let n=a('<div class="ref-product-data"></div>');if(s.append(n),i.full||i.name){let l=a('<h2 class="ref-name"></h2>');l.textContent=e.name,n.append(l)}if(i.full||i.price){let l=a('<strong class="ref-price"></strong>');l.textContent=e.priceFormatted,e.priceRange.length>1&&t&&(l.textContent=t.priceFormatted),n.append(l)}if(e.inventoryType=="advanced"&&e.showQuantity){let l=a('<span class="ref-qty-available"></span>');t?l.textContent=t.availableQuantity+" left in stock":l.textContent=e.availableQuantity+" left in stock",n.append(l)}if((i.full||i["add-to-cart"])&&(this.getCartURL()&&this.addToCart.setCartURL(this.getCartURL()),this.addToCart.update(e),n.append(this.addToCart.node)),i.full||i.description){let l=a('<div class="ref-description"></div>');l.innerHTML=e.descriptionHTML,n.append(l)}this.node.innerHTML="",this.node.append(s)}},K=O;g(K,"type","product");var de=K;var Y=class extends q{init(){this.node.addEventListener("click",this.onClick.bind(this)),window.addEventListener("popstate",e=>{this.update()})}getAPIEndpoint(){let e=this.node.dataset,t=new URL(location.href),i=this.getPage(),s=e.reflowPerpage||t.searchParams.get("per_page")||20,r=e.reflowCategory||t.searchParams.get("category"),n=e.reflowOrder||t.searchParams.get("order"),o=e.reflowSearch||t.searchParams.get("search"),l=`?page=${i}&perpage=${s}`;return r&&(l+="&category="+parseInt(r,10)),n&&(l+="&order="+encodeURIComponent(n)),o&&(l+="&search="+encodeURIComponent(o)),"/products/"+l}onClick(e){let t=e.target.closest(".ref-page-item");if(t){e.preventDefault();let i=t.dataset.reflowPage,s=new URL(window.location);s.searchParams.set("page",i),history.pushState({page:i},document.title,s),this.update()}}getPage(){let e,t=1;return this.hasDynamicPagination()&&(e=new URL(location.href).searchParams.get("page")),e||this.node.dataset.reflowPage||t}hasDynamicPagination(){let e=this.parseShowString();return e.full||e.pagination}renderPaginationItem(e=1,t="1",i=!1,s=!1,r=""){let n=a('<li class="ref-page-item"></li>');n.dataset.reflowPage=e;let o=i?a('<span class="ref-page-link"></span>'):a('<a class="ref-page-link"></a>');if(o.textContent=t,r&&(r=="ref-prev-btn"&&(o.innerHTML="<?xml version='1.0' encoding='iso-8859-1'?><svg version='1.1' id='Capa_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 34.075 34.075' style='enable-background:new 0 0 34.075 34.075;' xml:space='preserve'><g><g><path style='fill:currentColor;' d='M24.57,34.075c-0.505,0-1.011-0.191-1.396-0.577L8.11,18.432c-0.771-0.771-0.771-2.019,0-2.79 L23.174,0.578c0.771-0.771,2.02-0.771,2.791,0s0.771,2.02,0,2.79l-13.67,13.669l13.67,13.669c0.771,0.771,0.771,2.021,0,2.792 C25.58,33.883,25.075,34.075,24.57,34.075z'/></g></g></svg>"),r=="ref-next-btn"&&(o.innerHTML="<?xml version='1.0' encoding='iso-8859-1'?><svg version='1.1' id='Capa_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 185.343 185.343' style='enable-background:new 0 0 185.343 185.343;' xml:space='preserve'><g><g><path style='fill:currentColor;' d='M51.707,185.343c-2.741,0-5.493-1.044-7.593-3.149c-4.194-4.194-4.194-10.981,0-15.175 l74.352-74.347L44.114,18.32c-4.194-4.194-4.194-10.987,0-15.175c4.194-4.194,10.987-4.194,15.18,0l81.934,81.934 c4.194,4.194,4.194,10.987,0,15.175l-81.934,81.939C57.201,184.293,54.454,185.343,51.707,185.343z'/></g></g></svg>"),o.classList.add(r)),i)n.classList.add("active");else{let l=new URL(window.location);l.searchParams.set("page",e),o.href=l}return s&&n.classList.add("disabled"),n.append(o),n}renderPagination(e={}){let t=e.current_page,i=e.per_page,s=e.total,r=Math.ceil(s/i);if(r<=1)return document.createDocumentFragment();let n=a('<ul class="ref-pagination"></ul>'),o=t-1<=0,l=o?1:t-1,c=t+1>r,d=c?r:t+1;n.append(this.renderPaginationItem(l,"",!1,o,"ref-prev-btn"));for(var p=0;p<r;p++)n.append(this.renderPaginationItem(p+1,p+1,t===p+1));return n.append(this.renderPaginationItem(d,"",!1,c,"ref-next-btn")),n}async update(){let e;try{e=await this.fetchData()}catch(n){console.error("Reflow:",n)}if(!e||!e.data.length){this.node.innerHTML="<div>No products found</div>";return}let t=a('<div class="reflow-product-list"></div>'),i=a('<div class="ref-products"></div>'),s=this.node.dataset.reflowLayout;s&&Y.possibleLayouts.includes(s)&&t.classList.add("ref-"+s);let r=this.parseShowString();for(let n of e.data){let o=a('<div class="ref-product"></div>');this.node.dataset.reflowProductLink&&(o=a('<a class="ref-product"></a>'),o.href=this.node.dataset.reflowProductLink.replace(/\{id\}/g,n.id));let l=a('<div class="ref-product-data"></div>'),c=!1,d=a('<div class="ref-product-info"></div>'),p=!1;if(r.full||r.image){let h=a('<img class="ref-image">');h.src=n.image.md,h.loading="lazy",o.append(h)}if(r.full||r.name){let h=a('<h5 class="ref-name"></h5>');h.textContent=n.name,d.append(h),p=!0,c=!0}if(r.full||r.excerpt){let h=a('<p class="ref-excerpt"></p>');h.textContent=n.excerpt,d.append(h),p=!0,c=!0}if(p&&l.append(d),r.full||r.price){let h=a('<p class="ref-price"></p>');h.textContent=n.priceRangeFormatted,l.append(h),c=!0}c&&o.append(l),i.append(o)}if(t.append(i),r.full||r.pagination){let n=this.renderPagination(e.meta);t.append(n)}this.node.innerHTML="",this.node.append(t)}},F=Y;g(F,"type","product-list"),g(F,"possibleLayouts",["list","cards"]);var ce=F;var G=class extends q{constructor(e,t={}){super(e,t);g(this,3);e.innerHTML=`
        <div class="reflow-product-search">
            <div class="ref-input-wrapper">
                <input type="text" class="ref-search" inputmode="search" />
                <span class="ref-cancel-search"></span>
            </div>
            <div class="ref-button" type="submit">Search</div>
        </div>`,this.input=e.querySelector("input.ref-search"),this.cancel=e.querySelector("span.ref-cancel-search"),this.searchBtn=e.querySelector(".ref-button")}init(){var e,t;this.input.addEventListener("keydown",this.onKeyDown.bind(this)),this.input.addEventListener("input",this.onInput.bind(this)),this.cancel.addEventListener("click",this.cancelSearch.bind(this)),this.searchBtn.addEventListener("click",this.redirectToProdListing.bind(this)),this.input.value=new URL(location.href).searchParams.get("search"),this.cancel.style.display=this.input.value.length?"block":"none",this.input.placeholder=(e=this.node.dataset.reflowPlaceholder)!=null?e:"Search Products",this.searchBtn.style.display=this.node.dataset.reflowShowButton=="true"?"block":"none",this.searchBtn.textContent=(t=this.node.dataset.reflowButtonText)!=null?t:"Search"}onKeyDown(e){if(e.key=="Enter"){if(!this.input.value.trim().length){this.cancelSearch();return}this.redirectToProdListing()}e.key=="Escape"&&this.cancelSearch()}onInput(){this.cancel.style.display=this.input.value.length?"block":"none"}cancelSearch(){this.input.value="";let e=new URL(location.href);e.searchParams.get("search")&&(e.searchParams.set("search",""),window.location=e.href),this.cancel.style.display="none"}redirectToProdListing(){let e=this.input.value.trim();if(!e){this.input.value="",this.input.blur();return}let t=new URL(this.node.dataset.reflowSearchUrl||window.location.href,window.location.href);t.searchParams.set("search",e),window.location=t.href}};g(G,"type","product-search");var pe=G;var J=class extends q{constructor(e,t={}){super(e,t);this.reflowCategoryLink=e.dataset.reflowCategoryLink}getAPIEndpoint(){let t=this.node.dataset.reflowRootCategory;return"categories"+(t?"?root-category="+parseInt(t,10):"")}async update(){let e=await this.fetchData();if(!e)return;let t=this.node.dataset.reflowLayout,i=a('<div class="reflow-category-list"></div>');t&&J.possibleLayouts.includes(t)&&i.classList.add("ref-"+t);let s=a('<ul class="ref-categories"></ul>');i.append(s),this.buildListsRecursive(s,e),this.node.innerHTML="",this.node.append(i)}buildListsRecursive(e,t){for(let i of t){let s=a('<li class="ref-category"></li>'),r=i.subcategories;e.append(s);let n=a("<span></span>");if(this.node.dataset.reflowCategoryLink&&(n=a("<a></a>"),n.href=this.node.dataset.reflowCategoryLink.replace(/\{id\}/g,i.id)),n.textContent=i.name,s.append(n),r&&r.length){this.node.dataset.reflowLayout!=="unstyled"&&s.classList.add("ref-dropdown-toggle");let o=a("<ul></ul>");s.append(o),this.buildListsRecursive(o,r)}}}},V=J;g(V,"type","category-list"),g(V,"possibleLayouts",["unstyled","horizontal-bar","vertical-bar"]);var he=V;var X=class extends q{constructor(e,t={}){super(e,t);g(this,"_state",null);g(this,"possibleTypes",["dropdown","sidebar"]);g(this,"backendUpdateTimeout",null);g(this,"pendingBackendUpdates",{});this.backdrop=a('<div class="ref-backdrop"></div>'),this.summary=a(`
			<div class="ref-summary">
				<div class="ref-summary-header">
					<h5 class="ref-summary-title">Cart</h5>
					<div class="ref-close-button">\xD7</div>
				</div>
				<div class="ref-summary-body">
					<div class="ref-loading-overlay"></div>
					<div class="ref-message">Your cart is currently empty.</div>
					<div class="ref-cart-summary">
						<div class="ref-products"></div>
						<hr>
						<div class="ref-totals">
							<div class="ref-subtotal">
								<div class="ref-row"><span>Всего</span><span></span></div>
							</div>
							<div class="ref-shipping-taxes">Доставка и налоги рассчитываются во время оформления заказа.</div>
						</div>
					</div>
				</div>
				<div class="ref-summary-footer">
					<a href="#" class="ref-button"></a>
				</div>
			</div>
		`),this.summaryBody=this.summary.querySelector(".ref-summary-body"),this.loadingOverlay=this.summary.querySelector(".ref-loading-overlay"),this.productContainer=this.summary.querySelector(".ref-products"),this.button=this.summary.querySelector(".ref-summary-footer .ref-button"),this.productQuantityWidget=new WeakMap}init(){this.node.addEventListener("click",this.onButtonClick.bind(this)),this.summary.addEventListener("click",this.onSidebarClick.bind(this)),this.scheduleRefresh=z(this.refresh.bind(this),250),M("reflow-add-to-cart",this.scheduleRefresh),M("reflow-update-cart-product",this.scheduleRefresh),M("reflow-remove-cart-product",this.scheduleRefresh)}onButtonClick(e){if(!e.target.closest(".ref-summary")){this.toggle();return}}async onSidebarClick(e){if(e.target.closest(".ref-close-button")){e.preventDefault(),e.stopPropagation(),this.hide();return}if(e.target.matches(".ref-product-remove")){e.preventDefault(),e.stopPropagation();let t=e.target.closest(".ref-product"),i=this.productQuantityWidget.get(t),s=i.getProduct(),r=i.getVariant(),n=new FormData,o=t.dataset.personalization;o&&o.length&&n.append("personalization",o),Reflow.cart.scheduleAPICall(s+"-remove",()=>Reflow.cart.removeProduct(s,r,n),0)}}get state(){return this.demoMode?this._state||null:this._state||Reflow.cart.state||null}set state(e=null){this._state=e}toggle(){this.isSummaryOpen()?this.hide():this.show()}hide(){this.summary.classList.remove("open"),!this.isDemoMode()&&this.hasSummary()&&(this.backdrop.remove(),this.backdrop.classList.remove("active")),this.refresh()}show(){this.summary.classList.add("open"),!this.isDemoMode()&&this.hasSummary()&&(this.node.append(this.backdrop),this.backdrop.classList.add("active")),this.refresh()}get key(){return localStorage.reflowCartKey}hasSummary(){return this.possibleTypes.includes(this.getSummaryType())}getSummaryType(){return this.node.dataset.reflowSummaryType}getSummaryPosition(){return this.node.dataset.reflowSummaryPosition}isSummaryOpen(){return this.summary.classList.contains("open")}getCartURL(){return this.node.dataset.reflowShoppingcartUrl}setCartURL(e){this.node.dataset.reflowShoppingcartUrl=e}formatMoney(e){return A(e,this.state.currencyConfig)}calculateTotalQuantity(){return this.demoMode?this.state?this.state.products.reduce((e,t)=>e+t.quantity,0):0:Reflow&&Reflow.cart?Reflow.cart.quantity:0}renderProductCompact(e){let t=a(`
			<div class="ref-product">
				<div class="ref-product-col">
					<img class="ref-product-photo">
					<div class="ref-product-controls">
						<div class="ref-row">
							<div>
								<div class="ref-product-name"></div>
								<div class="ref-product-personalization-holder"></div>
							</div>
							<div class="ref-product-total"></div>
						</div>
						<div class="ref-product-quantity"></div>
						<div class="ref-product-qty-message"></div>
					</div>
				</div>
			</div>
		`),i=e.name;e.variant&&(i+=` (${e.variant.name})`);let s=a(".ref-product-photo",t)[0];if(s.src=e.image.sm,s.alt=i,a(".ref-product-name",t)[0].textContent=i,e.inStock&&e.quantity>e.availableQuantity?a(".ref-product-qty-message",t)[0].textContent=e.availableQuantity>0?`Only ${e.availableQuantity} left in stock.`:"0 left in stock":e.inStock&&e.quantity>e.maxQty?a(".ref-product-qty-message",t)[0].textContent=`Maximum of ${e.maxQty} per customer`:a(".ref-product-qty-message",t)[0].remove(),a(".ref-product-total",t)[0].textContent=e.inStock?this.formatMoney(e.price):"Out of Stock",e.personalization&&e.personalization.length)try{t.dataset.personalization=JSON.stringify(e.personalization.map(c=>{let d={id:c.id};return c.inputText&&(d.inputText=c.inputText),d}));let l=a(".ref-product-personalization-holder",t)[0];for(let c of e.personalization){let d=a('<div class="ref-product-personalization"></div>'),p=`${c.name}${c.inputText?': "'+c.inputText+'"':""}`;d.title=p,p=p.length>25?p.substring(0,25)+"...":p,d.textContent=p,l.append(d)}}catch(l){console.error("Reflow:",l)}let r=a("<div></div>"),n=new I(r,{inStock:e.inStock,onChange:l=>{let c=l.getProduct(),d=l.getQuantity(),p=l.getVariant(),h=new FormData,v=t.dataset.personalization;v&&v.length&&h.append("personalization",v),Reflow.cart.scheduleAPICall(c+(p?`-${p}`:"")+"-quantity",()=>Reflow.cart.updateProduct(c,d,p,h))}});n.init(),e.variant&&n.setVariant(e.variant.id),n.setProduct(e.id),n.setMaxQuantity(Math.min(e.availableQuantity,e.maxQty)),n.setQuantity(e.quantity),n.update();let o=a(".ref-product-quantity",t)[0];return o.append(n.node),o.append(a('<div class="ref-product-remove">Удалить</div>')),this.productQuantityWidget.set(t,n),t}async refreshState(){if(this.mockData){this.state=this.mockData;return}this.isSummaryOpen()&&await Reflow.cart.refresh()}async refresh(){this.showLoading(),await this.refreshState(),this.hideLoading(),this.update()}showLoading(){this.loadingOverlay.classList.add("visible")}hideLoading(){this.loadingOverlay.classList.remove("visible")}async update(){if(!this.state)try{await this.refreshState()}catch(t){this.productContainer.textContent="Unable to load Корзина.";return}let e=this.calculateTotalQuantity();if(this.node.dataset.reflowCount=e,e?this.node.classList.add("has-quantity"):this.node.classList.remove("has-quantity"),this.node.classList.add("reflow-cart-toggler"),this.hasSummary()){if(this.isSummaryOpen()){let t=this.summaryBody.querySelector(".ref-cart-summary"),i=this.summaryBody.querySelector(".ref-message");this.productContainer.innerHTML="";let s="close",r="Close",n="#";if(!this.state.products.length)t.style.display="none",i.style.display="block";else{for(let d of this.state.products)this.productContainer.append(this.renderProductCompact(d));let l=this.summaryBody.querySelector(".ref-subtotal");l.firstElementChild.children[1].textContent=this.formatMoney(this.state.subtotal);let c=this.getCartURL();c&&(s="checkout",r="Checkout",n=c+"?checkout"),t.style.display="flex",i.style.display="none"}s==="close"?this.button.classList.add("ref-close-button"):this.button.classList.remove("ref-close-button"),this.button.style.display="inline-block",this.button.href=n,this.button.textContent=r}this.summary.classList.remove("sidebar","dropdown","left","right"),this.summary.classList.add(this.getSummaryType(),this.getSummaryPosition()),this.node.append(this.summary),this.node.classList.add("has-summary")}else this.summary.remove(),this.node.classList.remove("has-summary");return this.node}};g(X,"type","view-cart");var ue=X;var fe=class{constructor(){g(this,"_state",null);g(this,"backendUpdateTimeout",null);g(this,"pendingBackendUpdates",{})}calculateTotalQuantity(){return this.state?this.state.products.reduce((e,t)=>e+t.quantity,0):0}get key(){return localStorage.reflowCartKey}set key(e){localStorage.reflowCartKey=e}get state(){return this._state}set state(e){this._state=e,this.quantity=this.calculateTotalQuantity()}get quantity(){return parseInt(localStorage.reflowCartQuantity,10)||0}set quantity(e){localStorage.reflowCartQuantity=e}async create(){return(await x("/carts/",{method:"POST"},!1)).cartKey}async fetch(e,t={}){let i="",s=[];for(let r in t)s.push(`${r}=${t[r]}`);return s.length&&(i="?"+s.join("&")),await x("/carts/"+e+i,{},!1)}async refreshState(e={}){try{if(this.key)this.state=await this.fetch(this.key,e);else throw new Error("No Key")}catch(t){!t.status||t.status==404?(this.key=await this.create(),this.state=await this.fetch(this.key,e)):console.error("Reflow:",t)}}async refresh(e={}){await this.refreshState(e)}async addProduct(e,t=1,i,s){let r="";this.key&&(r="?cartKey="+this.key);let n="/add-to-cart/"+e;n+="/"+t,i&&(n+="/"+i),n+=r;let o=await x(n,{method:"POST",body:s});return o.cartKey&&(this.key=o.cartKey),Q("reflow-add-to-cart",document,{productID:e}),this.quantity=o.cartQuantity,o}async updateProduct(e,t=1,i,s){let r=await x(`/update-cart-product/${this.key}/${e}/`+t+"/"+(i||""),{method:"POST",body:s},!1);return Q("reflow-update-cart-product",document,{productID:e}),this.quantity=r.cartQuantity,r}async removeProduct(e,t,i){let s=await x(`/remove-cart-product/${this.key}/${e}/`+(t||""),{method:"POST",body:i},!1);return Q("reflow-remove-cart-product",document,{productID:e}),this.quantity=s.cartQuantity,s}async updateDetails(e){return x(`/update-details/${this.key}/`,{method:"POST",body:e},!1)}async updateShipping(e){return x(`/update-shipping/${this.key}/`,{method:"POST",body:e},!1)}async updateAddress(e){return x(`/update-address/${this.key}/`,{method:"POST",body:e},!1)}async createPaypalOrder(e,t){return(await x(`/create-paypal-order/${this.key}/`,{method:"POST"},!1)).orderID}async capturePaypalOrder(e,t){let i=new FormData;i.append("orderID",e.orderID);try{return await x(`/capture-paypal-order/${this.key}/`,{method:"POST",body:i},!1)}catch(s){if(!s.data)throw s;let r=s.data,n=Array.isArray(r.details)&&r.details[0];if(n&&n.issue==="INSTRUMENT_DECLINED")return t.restart();throw s}}async updatePaypalShipping(e,t){try{let i=new FormData;i.append("orderID",e.orderID),i.append("address",JSON.stringify(e.shipping_address));let s=0;e.selected_shipping_option&&e.selected_shipping_option.id&&(s=e.selected_shipping_option.id),i.append("selectedShippingOption",s);let r=await x(`/update-paypal-shipping/${this.key}/`,{method:"POST",body:i},!1);return t.resolve()}catch(i){let s=i.data&&i.data.errors&&i.data.errors.system||"";return console.error("Reflow:",i),t.reject()}}scheduleAPICall(e,t,i=1e3){this.pendingBackendUpdates[e]=t,clearTimeout(this.backendUpdateTimeout),this.backendUpdateTimeout=setTimeout(async()=>{let s=[];for(let r in this.pendingBackendUpdates)s.push(this.pendingBackendUpdates[r]()),delete this.pendingBackendUpdates[r];await Promise.allSettled(s)},i)}},me=fe;var ee=class extends q{constructor(e,t){super(e,t);this.retries=0,this.maxRetries=6,this.retryTimeout=5e3,this.currencyConfig={}}init(){}async fetchData(){if(this.mockData)return this.currencyConfig=this.mockData.currencyConfig,this.mockData;let e=this.getAPIEndpoint(),t=await x(e,{},!1);return t.error?(console.error("Reflow:",t.error),null):(this.currencyConfig=t.currencyConfig,t)}getAPIEndpoint(){let e=new URL(location.href),t=this.node.dataset;if(t.reflowOrder&&t.reflowSecurehash)return"/orders/"+t.reflowOrder+"?secure_hash="+t.reflowSecurehash;let i=e.searchParams.get("session_id");if(i)return"/orders/stripe/"+i+"/";let s=e.searchParams.get("order_id"),r=e.searchParams.get("secure_hash");if(s&&r)return"/orders/"+s+"?secure_hash="+r;let n=new Error("Invalid API parameters");throw n.missingParams=!0,n}formatMoney(e){return A(e,this.currencyConfig)}async update(){var p;let e,t=a('<div class="reflow-order-status">Loading</div>');this.node.innerHTML="",this.node.append(t);try{e=await this.fetchData()}catch(h){throw h.missingParams?(t.textContent="Please check your email for order confirmation.",h):(this.retries++,this.retries>=this.maxRetries?(t.textContent="This is taking longer than usual. Please check your email for order confirmation.",h):(setTimeout(()=>{this.update()},this.retryTimeout),h))}t.innerHTML="";let i=a('<div class="col"></div>'),s=this.parseShowString(),r=a('<div class="ref-order-info"></div>'),n=a("<h2></h2>");n.innerHTML="Заказ #"+e.id,r.append(n);let o=a('<div class="ref-order-line ref-status"></div>');o.innerHTML="<b>Статус</b>"+e.status,r.append(o);let l=a('<div class="ref-order-line ref-created"></div>'),c=new Date(e.created_at*1e3);l.innerHTML=`<b>Выполнено</b>${c.toLocaleString()}`,r.append(l);let d=i.cloneNode();if(d.append(r),t.append(d),s.full||s.customer){let h=a('<div class="ref-order-customer"><h2>Информация о покупателе</h2></div>');if(e.customer.name){let y=a('<div class="ref-order-line ref-customer-name"></div>');y.textContent=e.customer.name,y.prepend(a("<b>Имя</b>")),h.append(y)}let v=a('<div class="ref-order-line ref-customer-email"></div>');if(v.textContent=e.customer.email,v.prepend(a("<b>Почта</b>")),h.append(v),e.customer.phone){let y=a('<div class="ref-order-line ref-customer-phone"></div>');y.textContent=e.customer.phone,y.prepend(a("<b>Телефон</b>")),h.append(y)}let m=i.cloneNode();m.append(h),t.append(m)}if((s.full||s.billing)&&e.billing_address){let h=a('<div class="ref-order-billing"><h2>Billing</h2></div>'),v=e.billing_address.find(P=>P.name=="Имя");if(v){let P=a('<div class="ref-order-line ref-billing-address"><b>Billing Name</b></div>'),w=a("<span></span>");w.textContent=v.val,P.append(w),h.append(P)}let m=a('<div class="ref-order-line ref-billing-address"><b>Платежный адрес</b></div>');for(let P of e.billing_address){if(P.name=="Имя")continue;let w=a("<span></span>");w.textContent=P.name+": "+P.val,m.append(w)}h.append(m);let y=i.cloneNode();y.append(h),t.append(y)}if(s.full||s.shipping){let h=a('<div class="ref-order-shipping"><h2>Доставка</h2></div>');if(e.shipping_method){let m=a('<div class="ref-order-line ref-shipping-method"><b>Метод доставки</b></div>'),y=a("<span></span>");y.textContent=e.shipping_method.name+(e.shipping_method.price?" ("+this.formatMoney(e.shipping_method.price)+")":""),m.append(y),h.append(m)}if(e.shipping_address){let m=a('<div class="ref-order-line ref-shipping-address"></div>');for(let y of e.shipping_address){let P=a("<span></span>");P.textContent=y.name+": "+y.val,m.append(P)}m.prepend(a("<b>Адрес доставки</b>")),h.append(m)}if(e.note){let m=a('<div class="ref-order-line ref-note"></div>');m.textContent=e.note,m.prepend(a("<b>Note</b>")),h.append(m)}let v=i.cloneNode();v.append(h),t.append(v)}if(s.full||s["line-items"]){let h=e.discounts?e.discounts.amount:0,v=e.shipping_method?e.shipping_method.price:0,m=e.paid_gross,y=e.taxes?e.taxes.amount:0,P=m+h-v-y,w=a('<div class="ref-line-items"><h2>Чек заказа</h2></div>');for(let[C,S]of e.products.entries()){let k=a('<div class="ref-order-line ref-line-item ref-product-line"><div class="ref-name"></div><div class="ref-price"><b></b><small></small></div></div>');if(k.querySelector(".ref-name").textContent=S.nameLine,k.querySelector(".ref-price b").textContent=S.priceFormatted,k.querySelector(".ref-price small").textContent=S.unitPriceLine,w.append(k),S.personalization&&S.personalization.length){w.append(a("<b>Personalizations</b>"));for(let R of S.personalization){let D=a('<div class="ref-order-line ref-line-item ref-personalization-line"><div class="ref-name"></div><div class="ref-price"><small></small></div></div>');if(D.querySelector(".ref-name").textContent=R.name,R.inputText){D.querySelector(".ref-name").textContent=R.name+": ";let ie=a("<small></small>");ie.textContent='"'+R.inputText+'"',D.querySelector(".ref-name").append(ie)}D.querySelector(".ref-price small").textContent=R.priceLine,w.append(D)}}C<e.products.length-1&&w.append(a('<div class="ref-tiny-separator">\u2219\u2219\u2219\u2219\u2219</div>'))}let u=a('<div class="ref-order-line ref-line-item">Всего <span class="ref-price"></span></div>');if(u.querySelector(".ref-price").textContent=this.formatMoney(P),w.append(a("<hr>")),w.append(u),v){let C=a('<div class="ref-order-line ref-line-item">Shipping <span class="ref-price"></span></div>');C.querySelector(".ref-price").textContent=this.formatMoney(v),w.append(C)}if(h){let C=a('<div class="ref-order-line ref-line-item"><div class="ref-name"></div><span class="ref-price"></span></div>');C.querySelector(".ref-name").textContent=e.discounts.coupon.name||e.discounts.coupon.code.toUpperCase(),C.querySelector(".ref-price").textContent="-"+this.formatMoney(h),w.append(C)}if((p=e.taxes)==null?void 0:p.amount){let C=e.taxes.details,S=C.taxRate,k=a('<div class="ref-order-line ref-line-item"><div class="ref-name"></div><span class="ref-price"></span></div>');k.querySelector(".ref-name").textContent=S.name+" ("+S.rate+"%)"+(C.exemption?" \u2013 "+C.exemption:""),k.querySelector(".ref-price").textContent=this.formatMoney(y),w.append(k)}let b=a('<div class="ref-order-line ref-line-item">Итого <b><span class="ref-price"></span></b></div>');b.querySelector(".ref-price").textContent=this.formatMoney(m),w.append(a("<hr>")),w.append(b);let L=i.cloneNode();L.append(w),t.append(L)}this.node.innerHTML="",this.node.append(t)}};g(ee,"type","order-status");var ye=ee;var ge=document.currentScript,te=parseInt(ge.getAttribute("data-reflow-store"),10),ve=!!ge.getAttribute("data-reflow-dev");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",be):be();function be(){if(!(!te&&(console.error("Reflow: Invalid Store ID"),!ve))){if("Reflow"in window){console.error("Reflow: window.Reflow already exists");return}window.Reflow={APIURL:"https://api.reflowhq.com/v1",storeID:te,cart:new me,version:"1.0.0",scan:we,api:x},setTimeout(()=>{document.dispatchEvent(new Event("reflow-ready",{cancelable:!0}))&&we(ve)},0)}}function we(f=!1){let e=[];e.push(...de.scan()),e.push(...ce.scan()),e.push(...pe.scan()),e.push(...he.scan()),e.push(...re.scan()),e.push(..._.scan()),e.push(...ye.scan()),e.push(...ue.scan()),e.length>10&&console.warn("Reflow: Only the first 10 components on this page will be rendered, the rest will be ignored."),e=e.slice(0,10);for(let t of e){if(t.init(),f&&!te){t.node.innerHTML="No Reflow Store ID provided.";continue}t.update().catch(i=>console.error("Reflow:",i))}}})();
